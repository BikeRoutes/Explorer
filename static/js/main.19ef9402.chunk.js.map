{"version":3,"sources":["model/index.ts","stringToColor.ts","queries/index.ts","components/View/index.ts","components/View/View.ts","components/Popup/Popup.tsx","components/Marker/Marker.tsx","components/Map/getDrinkingWater.ts","components/DrinkingWaterMarker.tsx","components/Map/Map.tsx","components/ElevationProfile.tsx","components/MapWithControls/MapWithControls.tsx","components/SideBar/SideBar.tsx","components/Explorer/Explorer.tsx","components/Details/Details.tsx","components/Navigation/Navigation.tsx","serviceWorkerRegistration.ts","components/ServiceWorkerWrapper.tsx","components/App/App.tsx","components/App/index.ts","setup/addDeviceClassName.ts","index.tsx"],"names":["viewToLocation","view","pathname","search","routeId","getOrElse","isColorNice","hexColor","hex","fromNullable","exec","map","match","r","parseInt","g","b","fold","rgb","colorArray","v","Math","pow","luminance","stringToDarkColor","string","color","newString","stringToColor","toGeoJson","require","currentView","Query","params","dependencies","location","fetch","Promise","resolve","locationToView","getRichFeature","feature","coordinates","minElevation","geometry","reduce","acc","c","Number","MAX_SAFE_INTEGER","maxElevation","MIN_SAFE_INTEGER","distances","_","i","concat","distanceDiff","geoJsonLength","type","slice","id","properties","url","name","length","round","elevationGain","filter","index","prevAltitude","undefined","altitude","routes","cacheStrategy","available","then","res","json","JSON","parse","body","features","route","isSome","value","parser","DOMParser","localStorage","getItem","gpx","geoJSONFeature","parseFromString","f","find","none","routeReadme","readmeUrl","text","some","View","props","className","column","vAlignContent","height","width","viewBox","onClick","style","cursor","marginTop","fillRule","transform","fill","opacity","cx","cy","rx","ry","d","options","a","roundedLat","lat","roundedLng","lng","formData","around","elements","enableBackground","mapboxgl","workerClass","default","md","mobileDetect","popupSettings","closeButton","closeOnClick","offset","anchor","getRouteDistanceInPixels","lngLat","point","project","LngLat","routePoint","distance","sqrt","abs","x","y","Infinity","_Map","popupSelectedRoute","Popup","popupHoveredRoute","positionWatch","drinkingWaterNodes","drinkingWaterMarkers","updateDrinkingWater","throttle","showDrinkingWater","getDrinkingWater","getCenter","addWaterMarkers","forEach","drinkingWaterNode","element","document","createElement","ReactDOM","DrinkingWaterMarker","marker","Marker","setLngLat","lon","addTo","push","onMouseMove","e","closestRoute","onRouteHover","hoveredRoute","accessToken","Map","container","center","parseFloat","zoom","scrollZoom","on","addLayers","addMarkers","startPosition","flyToRoute","animate","padding","isDesktop","this","innerRef","selectedRoute","navigating","layer","source","data","layout","paint","getRouteColor","onRouteSelect","addLayer","setPaintProperty","bounds","coord","LngLatBounds","extend","fitBounds","popup","latLng","setHTML","ReactDOMServer","showPopup","remove","identity","initializeMap","prevProps","updateLayers","updateSelectedRoutePopup","updateHoveredRoutePopup","isNone","drinkingWaterMarker","requestAnimationFrame","resize","grow","React","defaults","global","animation","ElevationProfile","interval","scale","ticks","uniq","number","roundedInteger","remainder","discriminatingFactor","flooredNumber","elevations","datasetKeyProvider","dataset","datasets","label","pointRadius","borderWidth","yAxisID","xAxisID","el","activeRoutePointIndex","backgroundColor","responsive","maintainAspectRatio","scales","xAxes","labels","toFixed","display","callback","yAxes","precision","maxRotation","stepSize","suggestedMin","suggestedMax","tooltips","mode","intersect","callbacks","title","tooltipItems","footer","legend","noSleep","NoSleep","MapWithControls","userLocationMarker","positionWatchCheckInterval","compassIcon","interacting","previousClosestRoutePoint","state","position","deviceBearing","showElevationProfile","geoLocationState","startWatchingPosition","navigator","geolocation","watchPosition","setItem","String","coords","latitude","longitude","setState","enableHighAccuracy","window","setInterval","Date","now","timestamp","stopWatchingPosition","clearWatch","clearInterval","startWatchingDeviceOrientation","addEventListener","onDeviceOrientation","stopWatchingDeviceOrientation","removeEventListener","onVisibilityChange","hidden","getCoordinatesSubset","steps","innerWidth","devicePixelRatio","max","getClosestRoutePoint","chain","navigatingRoute","closestRoutePoint","userLat","userLng","CheapRuler","updateInnerRef","addControl","ScaleControl","onSortRoutes","rotateUserLocationDot","bearing","getElementById","htmlElement","degree","getBearing","transformRotation","updateUserLocationDotMarker","shrink","centerOnUserLocation","flyTo","duration","essential","setTimeout","animationDurationMS","onNorthTrackingClick","onCompassTrackingClick","alpha","beta","gamma","compassHeading","enable","disable","alphaRad","PI","betaRad","gammaRad","cA","cos","sA","sin","sB","cG","sG","rA","rB","atan","prevState","speed","pos","showScale","speedometer","hAlignContent","altimeter","altitudeControl","background","drinkingWaterControl","geoLocateControl","paddingTop","paddingRight","toUndefined","Route","isSelected","size","onDetailsClick","commands","declareCommands","doUpdateLocation","accept","onChange","file","target","files","reader","FileReader","event","result","readAsText","key","onRouteClick","stopPropagation","queries","declareQueries","forceUpdate","sortedRoutes","sortBy","linkify","togpx","Remarkable","RemarkableModule","Markdown","images","Array","from","querySelectorAll","h1","querySelector","innerText","flat","onEnterNavigation","blob","Blob","saveAs","saveGPX","dangerouslySetInnerHTML","__html","render","showThumbs","showStatus","showIndicators","infiniteLoop","autoPlay","image","src","alt","use","getRoutes","memoize","newArgs","prevArgs","isLocalhost","Boolean","hostname","register","config","URL","process","href","origin","swUrl","headers","response","contentType","get","status","indexOf","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","console","log","checkValidServiceWorker","scope","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error","ServiceWorkerWrapper","useState","showReload","setShowReload","waitingWorker","setWaitingWorker","onSWUpdate","waiting","useEffect","marginLeft","textDecoration","ww","postMessage","prewarm","App","deviceClassName","isTablet","isPhone","documentElement","StrictMode"],"mappings":"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","file":"static/js/main.19ef9402.chunk.js","sourcesContent":["import { HistoryLocation as HistoryLocationT } from \"@buildo/bento/data\";\nimport { Option, fromNullable } from \"fp-ts/lib/Option\";\n\nexport type HistoryLocation = HistoryLocationT;\n\nexport type CurrentView =\n  | { view: \"explorer\" }\n  | { view: \"details\"; routeId: Option<string> }\n  | { view: \"navigation\"; routeId: Option<string> };\n\nexport function locationToView(location: HistoryLocation): CurrentView {\n  switch (location.search.view) {\n    case \"details\":\n      return {\n        view: \"details\",\n        routeId: fromNullable(location.search.routeId)\n      };\n    case \"navigation\":\n      return {\n        view: \"navigation\",\n        routeId: fromNullable(location.search.routeId)\n      };\n    default:\n      return { view: \"explorer\" };\n  }\n}\n\nexport function viewToLocation(view: CurrentView): HistoryLocation {\n  switch (view.view) {\n    case \"details\":\n      return {\n        pathname: \"/Explorer\",\n        search: { view: \"details\", routeId: view.routeId.getOrElse(\"\") }\n      };\n    case \"navigation\":\n      return {\n        pathname: \"/Explorer\",\n        search: { view: \"navigation\", routeId: view.routeId.getOrElse(\"\") }\n      };\n    case \"explorer\":\n      return { pathname: \"/Explorer\", search: {} };\n  }\n}\n\nexport type Content = {\n  name: string;\n  type: \"dir\" | \"file\";\n  url: string;\n  download_url: string;\n  html_url: string;\n};\n\ntype Latitude = number;\ntype Longitude = number;\ntype Elevation = number;\n\nexport type Geometry = {\n  type: \"LineString\";\n  coordinates: Array<[Longitude, Latitude, Elevation?]>;\n};\n\nexport type GeoJSONFeature = {\n  type: \"Feature\";\n  properties: {\n    name: string;\n    url: string;\n  };\n  geometry: Geometry;\n};\nexport type GeoJSONFeatureCollection = {\n  type: \"FeatureCollection\";\n  features: GeoJSONFeature[];\n};\n\ntype RouteProperties = {\n  name: string;\n  color: string;\n  length: number;\n  elevationGain: number;\n  minElevation: number;\n  maxElevation: number;\n  distances: number[];\n  url: string;\n};\n\nexport type Route = Omit<GeoJSONFeature, \"properties\"> & {\n  id: string;\n  properties: RouteProperties;\n};\n","import * as stringToColor from \"string-to-color\";\nimport { fromNullable } from \"fp-ts/lib/Option\";\n\nexport const hexToRgb = (hex: string) => {\n  const result = fromNullable(\n    /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n  );\n\n  return result.map(match => ({\n    r: parseInt(match[1], 16),\n    g: parseInt(match[2], 16),\n    b: parseInt(match[3], 16)\n  }));\n};\n\nexport const isColorNice = (hexColor: string): boolean => {\n  return hexToRgb(hexColor).fold(false, rgb => {\n    const { r, g, b } = rgb;\n\n    const colorArray = [r / 255, g / 255, b / 255].map(v => {\n      if (v <= 0.03928) {\n        return v / 12.92;\n      }\n\n      return Math.pow((v + 0.055) / 1.055, 2.4);\n    });\n\n    const luminance =\n      0.2126 * colorArray[0] + 0.7152 * colorArray[1] + 0.0722 * colorArray[2];\n\n    return luminance <= 0.5 && luminance >= 0.1;\n  });\n};\n\nconst stringToDarkColor = (string: string, color: string): string => {\n  const newString = `${string}$`;\n  return isColorNice(color)\n    ? color\n    : stringToDarkColor(newString, stringToColor(newString));\n};\n\nexport default (string: string): string => {\n  return stringToDarkColor(string, stringToColor(string));\n};\n","import { Query, location, available } from \"@buildo/bento/data\";\nimport {\n  locationToView,\n  Geometry,\n  Route,\n  GeoJSONFeature,\n  GeoJSONFeatureCollection\n} from \"../model\";\nimport * as geoJsonLength from \"geojson-length\";\nimport { Option, fromNullable, none, some } from \"fp-ts/lib/Option\";\nimport stringToColor from \"../stringToColor\";\n\nconst toGeoJson = require(\"@mapbox/togeojson\");\n\nfunction getElevationGain(coordinates: Geometry[\"coordinates\"]): number {\n  return coordinates\n    .filter(c => c[2])\n    .reduce((acc, c, index) => {\n      const prevAltitude = index > 0 ? coordinates[index - 1][2] : undefined;\n      const altitude = c[2]!;\n\n      if (prevAltitude && altitude > prevAltitude) {\n        return acc + altitude - prevAltitude;\n      }\n\n      return acc;\n    }, 0);\n}\n\nexport { location };\n\nexport const currentView = Query({\n  params: {},\n  dependencies: { location: location },\n  fetch: ({ location }) => Promise.resolve(locationToView(location))\n});\n\nconst getRichFeature = (feature: GeoJSONFeature): Route => {\n  const minElevation = feature.geometry.coordinates.reduce(\n    (acc: number, c) => (c[2] && c[2] < acc ? c[2] : acc),\n    Number.MAX_SAFE_INTEGER\n  );\n\n  const maxElevation = feature.geometry.coordinates.reduce(\n    (acc: number, c) => (c[2] && c[2] > acc ? c[2] : acc),\n    Number.MIN_SAFE_INTEGER\n  );\n\n  const distances = feature.geometry.coordinates.reduce((acc, _, i) => {\n    if (i === 0) {\n      return acc.concat(0);\n    } else {\n      const distanceDiff =\n        geoJsonLength({\n          type: \"LineString\",\n          coordinates: feature.geometry.coordinates.slice(i - 1, i + 1)\n        }) / 1000;\n\n      return acc.concat(acc[i - 1] + distanceDiff);\n    }\n  }, [] as number[]);\n\n  const richFeature: Route = {\n    id: feature.properties.url,\n    ...feature,\n    properties: {\n      ...feature.properties,\n      color:\n        feature.properties.url !== \"gpx\"\n          ? stringToColor(feature.properties.name)\n          : \"#38ffcc\",\n      length: Math.round(geoJsonLength(feature.geometry) / 100) / 10,\n      elevationGain: Math.round(getElevationGain(feature.geometry.coordinates)),\n      minElevation,\n      maxElevation,\n      distances\n    }\n  };\n\n  return richFeature;\n};\n\nexport const routes = Query({\n  cacheStrategy: available,\n  params: {},\n  fetch: (): Promise<Route[]> =>\n    // fetch(\"http://localhost:8081/\")\n    fetch(\"https://or52hotxz1.execute-api.us-east-1.amazonaws.com/dev/\")\n      .then(res => res.json() as Promise<{ body: string }>)\n      .then((res): GeoJSONFeature[] => JSON.parse(res.body))\n      .then(features => features.map(getRichFeature))\n});\n\nexport const route = Query({\n  params: {},\n  dependencies: { currentView, routes },\n  fetch: ({ currentView, routes }): Promise<Option<Route>> => {\n    if (\n      (currentView.view === \"details\" || currentView.view === \"navigation\") &&\n      currentView.routeId.isSome()\n    ) {\n      const routeId = currentView.routeId.value;\n\n      if (routeId === \"gpx\") {\n        const parser = new DOMParser();\n\n        return Promise.resolve(\n          fromNullable(localStorage.getItem(\"gpxFile\")).map(gpx => {\n            const featureCollection: GeoJSONFeatureCollection = toGeoJson.gpx(\n              parser.parseFromString(gpx, \"text/xml\")\n            );\n\n            const geoJSONFeature: GeoJSONFeature = featureCollection.features\n              .filter(f => f.geometry.type === \"LineString\")\n              .reduce((acc, feature) => {\n                return {\n                  ...acc,\n                  geometry: {\n                    ...acc.geometry,\n                    coordinates: acc.geometry.coordinates.concat(\n                      feature.geometry.coordinates\n                    )\n                  }\n                };\n              });\n\n            return getRichFeature({\n              ...geoJSONFeature,\n              properties: {\n                ...geoJSONFeature.properties,\n                url: \"gpx\"\n              }\n            });\n          })\n        );\n      } else {\n        return Promise.resolve(\n          fromNullable(routes.find(r => r.id === routeId))\n        );\n      }\n    }\n\n    return Promise.resolve(none);\n  }\n});\n\nexport const routeReadme = Query({\n  params: {},\n  dependencies: { route },\n  fetch: ({ route }): Promise<Option<string>> => {\n    if (route.isSome()) {\n      const res = /BikeRoutes.+master\\/(.+)\\/.+$/.exec(\n        route.value.properties.url\n      )!;\n\n      const readmeUrl = `https://raw.githubusercontent.com/BikeRoutes/BikeRoutes/master/${res[1]}/README.md`;\n\n      return fetch(readmeUrl)\n        .then(r => r.text())\n        .then(text => some(text));\n    }\n    return Promise.resolve(none);\n  }\n});\n","import View from './View';\nexport default View;\n","import View from '@buildo/bento/components/FlexView';\nexport default View;\n","import * as React from \"react\";\nimport View from \"../View\";\nimport { Route } from \"../../model\";\n\nimport \"./popup.scss\";\n\nexport default (props: { route: Route }) => (\n  <View className=\"popup\" column>\n    <View className=\"name\">{props.route.properties.name}</View>\n    <View className=\"distance\" vAlignContent=\"bottom\">\n      <label>Distance</label> {props.route.properties.length} km\n    </View>\n    <View className=\"elevation\" vAlignContent=\"bottom\">\n      <label>Elevation</label> {props.route.properties.elevationGain} m\n    </View>\n  </View>\n);\n","import * as React from \"react\";\n\nexport default (props: { onClick: () => void }) => (\n  <svg\n    height=\"41px\"\n    width=\"27px\"\n    viewBox=\"0 0 27 41\"\n    onClick={props.onClick}\n    className=\"marker\"\n    style={{ cursor: \"pointer\", marginTop: \"-100%\" }}\n  >\n    <g fillRule=\"nonzero\">\n      <g transform=\"translate(3.0, 29.0)\" fill=\"#000000\">\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"10.5\"\n          ry=\"5.25002273\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"10.5\"\n          ry=\"5.25002273\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"9.5\"\n          ry=\"4.77275007\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"8.5\"\n          ry=\"4.29549936\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"7.5\"\n          ry=\"3.81822308\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"6.5\"\n          ry=\"3.34094679\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"5.5\"\n          ry=\"2.86367051\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"4.5\"\n          ry=\"2.38636864\"\n        />\n      </g>\n      <g fill=\"#3FB1CE\">\n        <path d=\"M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z\" />\n      </g>\n      <g opacity=\"0.25\" fill=\"#000000\">\n        <path d=\"M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z\" />\n      </g>\n      <g transform=\"translate(6.0, 7.0)\" fill=\"#FFFFFF\" />\n      <g transform=\"translate(8.0, 8.0)\">\n        <circle fill=\"#000000\" opacity=\"0.25\" cx=\"5.5\" cy=\"5.5\" r=\"5.4999962\" />\n        <circle fill=\"#FFFFFF\" cx=\"5.5\" cy=\"5.5\" r=\"5.4999962\" />\n      </g>\n    </g>\n  </svg>\n);\n","export type DrinkingWaterNode = { id: number; lat: number; lon: number };\n\nexport default async (options: {\n  around: number;\n  lat: number;\n  lng: number;\n}): Promise<DrinkingWaterNode[]> => {\n  // round to closest even decimal (ex: 45.53 -> 45.6; 45.49 -> 45.4)\n  const roundedLat = Math.round(options.lat * 5) / 5;\n  const roundedLng = Math.round(options.lng * 5) / 5;\n\n  const formData = `\n    [out:json];\n    (node[\"amenity\"=\"drinking_water\"](around:${options.around},${roundedLat},${roundedLng}););\n    out;>;out;\n  `;\n\n  return fetch(\n    `https://overpass-api.de/api/interpreter?data=${formData}&output&cache-only=true`\n  )\n    .then((res): Promise<{ elements: DrinkingWaterNode[] }> => res.json())\n    .then(res => res.elements);\n};\n","import * as React from \"react\";\n\nexport default (props: { color?: string }) => (\n  <svg\n    id=\"Layer_1\"\n    enableBackground=\"new 0 0 512 512\"\n    height=\"20px\"\n    viewBox=\"0 0 512 512\"\n    width=\"20px\"\n    fill={props.color || \"#393939\"}\n  >\n    <g>\n      <path d=\"m421.082 355.479c-16.269-24.198-32.288-43.872-32.962-44.698-2.849-3.49-7.115-5.514-11.62-5.514s-8.771 2.024-11.62 5.514c-.674.826-16.693 20.5-32.962 44.698-34.685 51.594-34.685 70.908-34.685 77.255 0 43.708 35.559 79.267 79.267 79.267s79.267-35.559 79.267-79.267c0-6.347 0-25.662-34.685-77.255z\" />\n      <path d=\"m71.233 64.267h224.934c8.284 0 15-6.716 15-15v-34.267c0-8.284-6.716-15-15-15h-224.934c-8.284 0-15 6.716-15 15v34.267c0 8.284 6.716 15 15 15z\" />\n      <path d=\"m56.233 159.6v64.267c0 8.284 6.716 15 15 15h19.267v-94.267h-19.267c-8.284 0-15 6.716-15 15z\" />\n      <path d=\"m329.366 256c0 8.284 6.716 15 15 15h64.268c8.284 0 15-6.716 15-15v-32.133c0-43.708-35.56-79.267-79.268-79.267h-67.466v94.267h52.466z\" />\n      <path d=\"m231.9 128.533h-1.067v-34.266h-94.267v34.267h-1.066c-8.284 0-15 6.716-15 15v96.4c0 8.284 6.716 15 15 15h96.4c8.284 0 15-6.716 15-15v-96.4c0-8.285-6.715-15.001-15-15.001z\" />\n    </g>\n  </svg>\n);\n","import * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\nimport * as ReactDOM from \"react-dom\";\nimport throttle from \"lodash/throttle\";\nimport { Map, MapMouseEvent } from \"mapbox-gl\";\nimport Popup from \"../Popup/Popup\";\nimport Marker from \"../Marker/Marker\";\nimport View from \"../View\";\nimport { Option, none, some } from \"fp-ts/lib/Option\";\nimport { Route } from \"../../model\";\nimport mobileDetect from \"@buildo/bento/utils/mobileDetect\";\nimport { identity } from \"fp-ts/lib/function\";\nimport getDrinkingWater, { DrinkingWaterNode } from \"./getDrinkingWater\";\nimport DrinkingWaterMarker from \"../DrinkingWaterMarker\";\n\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"./map.scss\";\n\nconst mapboxgl = require(\"mapbox-gl/dist/mapbox-gl-csp\");\n\nmapboxgl.workerClass = require(\"worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker\").default;\n\n/* eslint-disable array-callback-return */\n\nconst md = mobileDetect();\n\nconst popupSettings: mapboxgl.PopupOptions = {\n  closeButton: false,\n  closeOnClick: false,\n  offset: [0, -40],\n  anchor: \"bottom\"\n};\n\nexport const getRouteDistanceInPixels = (\n  route: Route,\n  lngLat: { lng: number; lat: number },\n  map: Map\n): number => {\n  return route.geometry.coordinates.reduce((acc, coordinates) => {\n    const point = map.project(new mapboxgl.LngLat(lngLat.lng, lngLat.lat));\n    const routePoint = map.project(\n      new mapboxgl.LngLat(coordinates[0], coordinates[1])\n    );\n    const distance = Math.sqrt(\n      Math.pow(Math.abs(point.x - routePoint.x), 2) +\n        Math.pow(Math.abs(point.y - routePoint.y), 2)\n    );\n    return distance < acc ? distance : acc;\n  }, Infinity);\n};\n\nexport type Props = {\n  routes: Route[];\n  selectedRoute: Option<Route>;\n  hoveredRoute: Option<Route>;\n  onRouteHover?: (route: Option<Route>) => void;\n  onRouteSelect?: (route: Route) => void;\n  innerRef?: (map: Map) => void;\n  onSortRoutes?: () => void;\n  startPosition: \"userLocation\" | \"firstRoute\";\n  navigating: boolean;\n  showDrinkingWater: boolean;\n};\n\nclass _Map extends React.PureComponent<Props> {\n  map: Option<Map> = none;\n  popupSelectedRoute: mapboxgl.Popup = new mapboxgl.Popup(popupSettings);\n  popupHoveredRoute: mapboxgl.Popup = new mapboxgl.Popup(popupSettings);\n  positionWatch: Option<number> = none;\n\n  drinkingWaterNodes: {\n    [id: string]: DrinkingWaterNode;\n  } = {};\n\n  drinkingWaterMarkers: mapboxgl.Marker[] = [];\n\n  updateDrinkingWater = throttle(() => {\n    if (this.props.showDrinkingWater) {\n      this.map.map(map => {\n        getDrinkingWater({\n          around: 20000,\n          lat: map.getCenter().lat,\n          lng: map.getCenter().lng\n        }).then(this.addWaterMarkers);\n      });\n    }\n  }, 1000);\n\n  initializeMap() {\n    (mapboxgl as any).accessToken =\n      \"pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw\";\n\n    const map = new mapboxgl.Map({\n      container: \"map\",\n      style:\n        \"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm?optimize=true\",\n      center: {\n        lat: parseFloat(localStorage.getItem(\"start_lat\") || \"45.46\"),\n        lng: parseFloat(localStorage.getItem(\"start_lng\") || \"9.19\")\n      },\n      zoom: 11.0,\n      scrollZoom: false\n    });\n\n    map.on(\"load\", () => {\n      this.map = some(map);\n\n      this.addLayers();\n      this.addMarkers();\n\n      if (\n        this.props.startPosition === \"firstRoute\" &&\n        this.props.routes.length > 0\n      ) {\n        this.flyToRoute(this.props.routes[0], { animate: false, padding: 80 });\n      }\n    });\n\n    if (md.isDesktop) {\n      map.on(\"mousemove\", this.onMouseMove);\n    }\n\n    map.on(\"move\", this.updateDrinkingWater);\n\n    this.props.innerRef && this.props.innerRef(map);\n  }\n\n  getRouteColor(route: Route): string {\n    return (this.props.selectedRoute.isSome() &&\n      route === this.props.selectedRoute.value) ||\n      (this.props.hoveredRoute.isSome() &&\n        route === this.props.hoveredRoute.value) ||\n      this.props.navigating\n      ? \"#387ddf\"\n      : route.properties.color;\n  }\n\n  addLayers() {\n    this.map.map(map => {\n      this.props.routes.forEach(route => {\n        const layer: mapboxgl.Layer = {\n          id: route.properties.url,\n          type: \"line\",\n          source: {\n            type: \"geojson\",\n            data: route as any\n          },\n          layout: {\n            \"line-join\": \"round\",\n            \"line-cap\": \"round\"\n          },\n          paint: {\n            \"line-width\": 3,\n            \"line-color\": this.getRouteColor(route)\n          }\n        };\n\n        map.on(\"click\", layer.id, () => {\n          this.props.onRouteSelect && this.props.onRouteSelect(route);\n        });\n\n        map.addLayer(layer);\n      });\n    });\n  }\n\n  addMarkers() {\n    this.map.map(map => {\n      this.props.routes.forEach(route => {\n        const coordinates = route.geometry.coordinates[0];\n\n        const element = document.createElement(\"div\");\n        ReactDOM.render(\n          <Marker\n            onClick={() =>\n              this.props.onRouteSelect && this.props.onRouteSelect(route)\n            }\n          />,\n          element\n        );\n\n        const marker: mapboxgl.Marker = new mapboxgl.Marker({\n          element\n        }).setLngLat([coordinates[0], coordinates[1]]);\n\n        marker.addTo(map);\n      });\n    });\n  }\n\n  addWaterMarkers = (drinkingWaterNodes: DrinkingWaterNode[]) => {\n    this.map.map(map => {\n      drinkingWaterNodes.forEach(drinkingWaterNode => {\n        if (!this.drinkingWaterNodes[drinkingWaterNode.id]) {\n          const element = document.createElement(\"div\");\n          ReactDOM.render(<DrinkingWaterMarker />, element);\n\n          const marker: mapboxgl.Marker = new mapboxgl.Marker({\n            element\n          }).setLngLat([drinkingWaterNode.lon, drinkingWaterNode.lat]);\n\n          marker.addTo(map);\n\n          this.drinkingWaterNodes[drinkingWaterNode.id] = drinkingWaterNode;\n\n          this.drinkingWaterMarkers.push(marker);\n        }\n      });\n    });\n  };\n\n  onMouseMove = throttle((e: MapMouseEvent) => {\n    type ClosestRoute = {\n      distance: number;\n      route: Route;\n    };\n\n    this.map.map(map => {\n      const closestRoute: ClosestRoute = this.props.routes.reduce(\n        (acc, route) => {\n          const distance = getRouteDistanceInPixels(route, e.lngLat, map);\n\n          return distance < acc.distance ? { distance, route } : acc;\n        },\n        { distance: Infinity } as ClosestRoute\n      );\n\n      if (closestRoute.distance < 25) {\n        this.props.onRouteHover &&\n          this.props.onRouteHover(some(closestRoute.route));\n      } else {\n        this.props.hoveredRoute.map(() => {\n          this.props.onRouteHover && this.props.onRouteHover(none);\n        });\n      }\n    });\n  }, 100);\n\n  updateLayers() {\n    this.map.map(map => {\n      this.props.routes.forEach(route => {\n        // update color\n        map.setPaintProperty(route.id, \"line-color\", this.getRouteColor(route));\n      });\n    });\n  }\n\n  flyToRoute(route: Route, options?: mapboxgl.FitBoundsOptions) {\n    this.map.map(map => {\n      const coordinates = route.geometry.coordinates as [number, number][];\n      const bounds = coordinates\n        .map(coord => new mapboxgl.LngLatBounds(coord, coord))\n        .reduce((bounds, coord) => {\n          return bounds.extend(coord);\n        });\n\n      map.fitBounds(bounds, { padding: 50, ...options });\n    });\n  }\n\n  showPopup(route: Route, popup: mapboxgl.Popup) {\n    this.map.map(map => {\n      const latLng: mapboxgl.LngLat = new mapboxgl.LngLat(\n        route.geometry.coordinates[0][0],\n        route.geometry.coordinates[0][1]\n      );\n\n      popup\n        .setLngLat(latLng)\n        .setHTML(ReactDOMServer.renderToString(<Popup route={route} />))\n        .addTo(map);\n    });\n  }\n\n  updateSelectedRoutePopup() {\n    if (this.props.selectedRoute.isSome()) {\n      this.showPopup(this.props.selectedRoute.value, this.popupSelectedRoute);\n    } else {\n      this.popupSelectedRoute.remove();\n    }\n  }\n\n  updateHoveredRoutePopup() {\n    const { hoveredRoute } = this.props;\n    if (\n      hoveredRoute.isSome() &&\n      hoveredRoute.value !== this.props.selectedRoute.fold(null, identity)\n    ) {\n      this.showPopup(hoveredRoute.value, this.popupHoveredRoute);\n    } else {\n      this.popupHoveredRoute.remove();\n    }\n  }\n\n  componentDidMount() {\n    this.initializeMap();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    this.updateLayers();\n    this.updateSelectedRoutePopup();\n    this.updateHoveredRoutePopup();\n\n    if (\n      this.props.selectedRoute.isSome() &&\n      (prevProps.selectedRoute.isNone() ||\n        prevProps.selectedRoute.value !== this.props.selectedRoute.value)\n    ) {\n      this.flyToRoute(this.props.selectedRoute.value);\n    }\n\n    if (!this.props.showDrinkingWater) {\n      this.drinkingWaterMarkers.forEach(drinkingWaterMarker => {\n        drinkingWaterMarker.remove();\n      });\n      this.drinkingWaterMarkers = [];\n      this.drinkingWaterNodes = {};\n    }\n\n    requestAnimationFrame(() => this.map.map(map => map.resize()));\n  }\n\n  render() {\n    return <View grow id=\"map\" />;\n  }\n}\n\nexport default _Map;\n","import * as React from \"react\";\nimport { Line, defaults } from \"react-chartjs-2\";\nimport { Route } from \"../model\";\nimport uniq from \"lodash/uniq\";\nimport { Option, none } from \"fp-ts/lib/Option\";\n\ndefaults.global.animation = 0;\n\ntype Props = {\n  route: Route;\n  activeRoutePointIndex?: number;\n};\n\nexport default class ElevationProfile extends React.Component<Props> {\n  interval: Option<NodeJS.Timeout> = none;\n\n  render() {\n    const scale = Math.round(this.props.route.properties.length / 10) || 1;\n\n    const round = (number: number, roundedInteger: number): number => {\n      const remainder = number % roundedInteger;\n      const discriminatingFactor = roundedInteger / 2;\n\n      const flooredNumber = Math.round(number - remainder);\n\n      if (remainder < discriminatingFactor) {\n        return flooredNumber;\n      } else {\n        return flooredNumber + roundedInteger;\n      }\n    };\n\n    const distances = this.props.route.properties.distances;\n\n    const ticks = uniq(distances.map(d => round(d, scale)));\n\n    const elevations = this.props.route.geometry.coordinates.map(c =>\n      c[2] ? Math.round(c[2]) : null\n    );\n\n    return (\n      <Line\n        datasetKeyProvider={dataset => dataset.datasetKeyProvider}\n        data={{\n          datasets: [\n            {\n              label: \"Elevation\",\n              pointRadius: 0,\n              borderWidth: 0,\n              yAxisID: \"y-axis\",\n              xAxisID: \"x-axis-hidden\",\n              data: elevations,\n              datasetKeyProvider: \"elevation\"\n            },\n            {\n              xAxisID: \"x-axis\",\n              data: [],\n              datasetKeyProvider: \"ticks\"\n            },\n            {\n              yAxisID: \"y-axis\",\n              data: elevations.map((el, i) =>\n                i === this.props.activeRoutePointIndex ? el : null\n              ),\n              backgroundColor: \"#5bb3e0\",\n              datasetKeyProvider: \"userLocation\"\n            }\n          ]\n        }}\n        options={{\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            xAxes: [\n              {\n                id: \"x-axis-hidden\",\n                type: \"category\",\n                labels: distances.map(d => d.toFixed(1)),\n                display: false\n              },\n              {\n                id: \"x-axis\",\n                labels: ticks,\n                ticks: {\n                  callback: (value: number) => {\n                    return value <= this.props.route.properties.length\n                      ? `${value} km`\n                      : null;\n                  }\n                }\n              }\n            ],\n            yAxes: [\n              {\n                type: \"linear\",\n                id: \"y-axis\",\n                ticks: {\n                  precision: 0,\n                  maxRotation: 0,\n                  stepSize: 50,\n                  suggestedMin: this.props.route.properties.minElevation * 0.7,\n                  suggestedMax: 300,\n                  ticks: {\n                    callback: (value: number) => {\n                      return `${value} m`;\n                    }\n                  }\n                }\n              }\n            ]\n          },\n          tooltips: {\n            mode: \"index\",\n            intersect: false,\n            callbacks: {\n              title: (tooltipItems: any[]) => {\n                return `Dist:  ${tooltipItems[0].label} km`;\n              },\n              label: () => \"\",\n              footer: (tooltipItems: any[], data: unknown) => {\n                return `Elev: ${tooltipItems[0].value} m`;\n              }\n            }\n          }\n        }}\n        legend={null}\n        height={50}\n      />\n    );\n  }\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport cx from \"classnames\";\nimport View from \"../View\";\nimport Map, { Props as MapProps } from \"../Map/Map\";\nimport { none, some, Option, fromNullable } from \"fp-ts/lib/Option\";\nimport NoSleep from \"nosleep.js\";\nimport ElevationProfile from \"../ElevationProfile\";\nimport mapboxgl from \"mapbox-gl\";\nimport { Route } from \"../../model\";\nimport throttle from \"lodash/throttle\";\nimport CheapRuler from \"cheap-ruler\";\nimport { identity } from \"fp-ts/lib/function\";\n\nimport \"./mapWithControls.scss\";\nimport DrinkingWaterMarker from \"../DrinkingWaterMarker\";\n\n/* eslint-disable array-callback-return */\n\nconst noSleep = new NoSleep();\n\ntype Props = Omit<MapProps, \"navigating\" | \"showDrinkingWater\"> & {\n  noSleep: boolean;\n  geoLocateControl: boolean;\n  altimeter: boolean;\n  speedometer: boolean;\n  navigatingRoute: Option<Route>;\n  altitudeControl: boolean;\n  drinkingWaterControl: boolean;\n  scale: boolean;\n};\n\ntype State = {\n  position: Option<Position>;\n  deviceBearing: Option<number>;\n  showElevationProfile: boolean;\n  showDrinkingWater: boolean;\n  geoLocationState:\n    | \"Off\"\n    | \"North\"\n    | \"NorthTracking\"\n    | \"Compass\"\n    | \"CompassTracking\";\n};\n\nclass MapWithControls extends React.Component<Props, State> {\n  map: Option<mapboxgl.Map> = none;\n  userLocationMarker: Option<mapboxgl.Marker> = none;\n\n  positionWatch: Option<number> = none;\n  positionWatchCheckInterval: Option<number> = none;\n\n  compassIcon: React.RefObject<SVGSVGElement> = React.createRef();\n\n  interacting: boolean = false;\n\n  previousClosestRoutePoint: Option<{\n    distance: number;\n    index: number;\n  }> = none;\n\n  state: State = {\n    position: none,\n    deviceBearing: none,\n    showElevationProfile: false,\n    showDrinkingWater: false,\n    geoLocationState:\n      this.props.startPosition === \"userLocation\" ? \"NorthTracking\" : \"Off\"\n  };\n\n  startWatchingPosition = () => {\n    this.positionWatch = some(\n      navigator.geolocation.watchPosition(\n        position => {\n          localStorage.setItem(\"start_lat\", String(position.coords.latitude));\n          localStorage.setItem(\"start_lng\", String(position.coords.longitude));\n\n          this.setState({ position: some(position) });\n        },\n        () => {},\n        { enableHighAccuracy: true }\n      )\n    );\n\n    this.positionWatchCheckInterval = some(\n      window.setInterval(() => {\n        this.state.position.map(position => {\n          // no update for > 15s\n          if (Date.now() - position.timestamp > 60000) {\n            this.stopWatchingPosition();\n            this.startWatchingPosition();\n          }\n        });\n      }, 30000)\n    );\n  };\n\n  stopWatchingPosition = () => {\n    this.positionWatch.map(positionWatch =>\n      navigator.geolocation.clearWatch(positionWatch)\n    );\n\n    this.positionWatchCheckInterval.map(positionWatchCheckInterval => {\n      window.clearInterval(positionWatchCheckInterval);\n    });\n  };\n\n  startWatchingDeviceOrientation = () => {\n    window.addEventListener(\n      \"deviceorientationabsolute\",\n      this.onDeviceOrientation,\n      true\n    );\n  };\n\n  stopWatchingDeviceOrientation = () => {\n    window.removeEventListener(\n      \"deviceorientationabsolute\",\n      this.onDeviceOrientation,\n      true\n    );\n  };\n\n  onVisibilityChange = () => {\n    if (document.hidden) {\n      this.stopWatchingDeviceOrientation();\n      this.stopWatchingPosition();\n    } else {\n      this.startWatchingDeviceOrientation();\n      if (this.state.geoLocationState !== \"Off\") {\n        this.startWatchingPosition();\n      }\n    }\n  };\n\n  componentDidMount() {\n    if (this.props.noSleep) {\n      noSleep.enable();\n    }\n\n    this.startWatchingDeviceOrientation();\n    if (this.state.geoLocationState !== \"Off\") {\n      this.startWatchingPosition();\n    }\n\n    document.addEventListener(\"visibilitychange\", this.onVisibilityChange);\n  }\n\n  componentWillUnmount() {\n    if (this.props.noSleep) {\n      noSleep.disable();\n    }\n\n    this.stopWatchingDeviceOrientation();\n    this.stopWatchingPosition();\n\n    document.removeEventListener(\"visibilitychange\", this.onVisibilityChange);\n  }\n\n  getCoordinatesSubset = (\n    coordinates: Route[\"geometry\"][\"coordinates\"]\n  ): Route[\"geometry\"][\"coordinates\"] => {\n    const hPixels = window.innerWidth * window.devicePixelRatio;\n    const steps = hPixels / 5;\n\n    return coordinates.filter(\n      (_, i) => i % Math.max(1, Math.round(coordinates.length / steps)) === 0\n    );\n  };\n\n  getClosestRoutePoint = (): Option<{ distance: number; index: number }> => {\n    if (this.interacting) {\n      return this.previousClosestRoutePoint;\n    }\n\n    return this.state.position.chain(position =>\n      this.props.navigatingRoute.chain(route => {\n        const closestRoutePoint = this.getCoordinatesSubset(\n          route.geometry.coordinates\n        ).reduce(\n          (acc, coordinates, index) => {\n            const userLat = coordinates[1];\n            const userLng = coordinates[0];\n\n            const ruler = new CheapRuler(userLat, \"meters\");\n\n            const distance = ruler.distance(\n              [userLat, userLng],\n              [position.coords.latitude, position.coords.longitude]\n            );\n\n            return distance < 200 && distance < acc.distance\n              ? { distance, index, coordinates }\n              : acc;\n          },\n          {\n            distance: Infinity,\n            index: -1\n          }\n        );\n\n        this.previousClosestRoutePoint =\n          closestRoutePoint.index >= 0 ? some(closestRoutePoint) : none;\n\n        return this.previousClosestRoutePoint;\n      })\n    );\n  };\n\n  updateInnerRef = (map: mapboxgl.Map) => {\n    this.props.innerRef && this.props.innerRef(map);\n\n    if (this.map.isNone()) {\n      this.map = some(map);\n\n      if (this.props.scale) {\n        map.addControl(new mapboxgl.ScaleControl());\n      }\n\n      map.on(\"touchstart\", () => {\n        this.interacting = true;\n      });\n\n      map.on(\"touchend\", () => {\n        this.interacting = false;\n      });\n\n      map.on(\"dragstart\", () => {\n        if (this.state.geoLocationState === \"NorthTracking\") {\n          this.setState({\n            geoLocationState: \"North\"\n          });\n        } else if (this.state.geoLocationState === \"CompassTracking\") {\n          this.setState({\n            geoLocationState: \"Compass\"\n          });\n        }\n      });\n\n      map.on(\"dragend\", () => {\n        this.props.onSortRoutes && this.props.onSortRoutes();\n      });\n    }\n  };\n\n  rotateUserLocationDot = () => {\n    this.map.map(map => {\n      this.state.deviceBearing.map(bearing => {\n        fromNullable(document.getElementById(\"userLocationDotWrapper\")).map(\n          htmlElement => {\n            const degree =\n              this.state.geoLocationState === \"CompassTracking\"\n                ? 0\n                : bearing - map.getBearing();\n\n            const transformRotation = `rotate(${degree}deg)`;\n\n            htmlElement.style.transform = transformRotation;\n          }\n        );\n      });\n    });\n  };\n\n  updateUserLocationDotMarker = () => {\n    this.map.map(map => {\n      this.state.position.map(position => {\n        const lngLat: mapboxgl.LngLatLike = {\n          lng: position.coords.longitude,\n          lat: position.coords.latitude\n        };\n\n        if (\n          this.state.geoLocationState !== \"Off\" &&\n          this.userLocationMarker.isNone()\n        ) {\n          // ADD MARKER\n          const element = document.createElement(\"div\");\n          element.className = \"userLocationDotMarker\";\n\n          ReactDOM.render(\n            <View column id=\"userLocationDotWrapper\">\n              <View shrink={false} className=\"triangle\"></View>\n              <View shrink={false} className=\"userLocationDot\"></View>\n            </View>,\n            element\n          );\n\n          const marker: mapboxgl.Marker = new mapboxgl.Marker({\n            element\n          }).setLngLat(lngLat);\n\n          marker.addTo(map);\n\n          this.userLocationMarker = some(marker);\n        } else if (\n          this.state.geoLocationState !== \"Off\" &&\n          this.userLocationMarker.isSome()\n        ) {\n          // UPDATE MARKER\n          this.userLocationMarker.value.setLngLat(lngLat);\n        } else if (\n          this.state.geoLocationState === \"Off\" &&\n          this.userLocationMarker.isSome()\n        ) {\n          // REMOVE MARKER\n          this.userLocationMarker.value.remove();\n          this.userLocationMarker = none;\n        }\n      });\n    });\n  };\n\n  centerOnUserLocation = (options: {\n    bearing: number;\n    animate: boolean;\n    zoom?: number;\n  }) => {\n    this.map.map(map => {\n      this.state.position.map(position => {\n        const animationDurationMS = 1000;\n\n        map.flyTo({\n          duration: animationDurationMS,\n          center: {\n            lng: position.coords.longitude,\n            lat: position.coords.latitude\n          },\n          essential: true,\n          ...options\n        });\n\n        if (options.animate) {\n          // smooth animation\n          this.interacting = true;\n          setTimeout(() => (this.interacting = false), animationDurationMS + 5);\n        }\n      });\n    });\n  };\n\n  onNorthTrackingClick = () => {\n    if (this.state.geoLocationState !== \"NorthTracking\") {\n      this.setState({ geoLocationState: \"NorthTracking\" });\n    } else if (this.state.geoLocationState === \"NorthTracking\") {\n      this.setState({ geoLocationState: \"Off\" });\n    }\n  };\n\n  onCompassTrackingClick = () => {\n    if (this.state.geoLocationState !== \"CompassTracking\") {\n      this.setState({ geoLocationState: \"CompassTracking\" });\n    } else if (this.state.geoLocationState === \"CompassTracking\") {\n      this.setState({ geoLocationState: \"Off\" });\n    }\n  };\n\n  compassHeading(alpha: number, beta: number, gamma: number): number {\n    // https://stackoverflow.com/questions/18112729/calculate-compass-heading-from-deviceorientation-event-api\n    // Convert degrees to radians\n    const alphaRad = alpha * (Math.PI / 180);\n    const betaRad = beta * (Math.PI / 180);\n    const gammaRad = gamma * (Math.PI / 180);\n\n    // Calculate equation components\n    const cA = Math.cos(alphaRad);\n    const sA = Math.sin(alphaRad);\n    // const cB = Math.cos(betaRad);\n    const sB = Math.sin(betaRad);\n    const cG = Math.cos(gammaRad);\n    const sG = Math.sin(gammaRad);\n\n    // Calculate A, B, C rotation components\n    const rA = -cA * sG - sA * sB * cG;\n    const rB = -sA * sG + cA * sB * cG;\n    // const rC = -cB * cG;\n\n    // Calculate compass heading\n    let compassHeading = Math.atan(rA / rB);\n\n    // Convert from half unit circle to whole unit circle\n    if (rB < 0) {\n      compassHeading += Math.PI;\n    } else if (rA < 0) {\n      compassHeading += 2 * Math.PI;\n    }\n\n    // Convert radians to degrees\n    compassHeading *= 180 / Math.PI;\n\n    return compassHeading;\n  }\n\n  onDeviceOrientation = throttle((e: DeviceOrientationEvent) => {\n    this.setState(\n      {\n        deviceBearing: fromNullable(e.alpha).chain(alpha =>\n          fromNullable(e.beta).chain(beta =>\n            fromNullable(e.gamma).map(gamma =>\n              this.compassHeading(alpha, beta, gamma)\n            )\n          )\n        )\n      },\n      this.rotateUserLocationDot\n    );\n  }, 16);\n\n  componentDidUpdate(_: unknown, prevState: State) {\n    // start watching position\n    if (\n      prevState.geoLocationState === \"Off\" &&\n      this.state.geoLocationState !== \"Off\"\n    ) {\n      this.startWatchingPosition();\n    }\n\n    // stop watching position\n    if (\n      prevState.geoLocationState !== \"Off\" &&\n      this.state.geoLocationState === \"Off\"\n    ) {\n      this.stopWatchingPosition();\n    }\n\n    // add, remove or update the position of the user location \"dot\" marker\n    this.updateUserLocationDotMarker();\n\n    // center the map on user position and point North\n    if (!this.interacting && this.state.geoLocationState === \"NorthTracking\") {\n      this.centerOnUserLocation({\n        bearing: 0,\n        animate: prevState.geoLocationState !== \"NorthTracking\"\n        // zoom:\n        //   prevState.geoLocationState === \"Off\" &&\n        //   this.props.navigatingRoute.isSome()\n        //     ? 15\n        //     : undefined\n      });\n    }\n\n    // center the map on user position and point to the device \"heading\"\n    if (\n      !this.interacting &&\n      this.state.geoLocationState === \"CompassTracking\"\n    ) {\n      this.centerOnUserLocation({\n        bearing: this.state.deviceBearing.fold(0, identity),\n        animate: prevState.geoLocationState !== \"CompassTracking\"\n        // zoom:\n        //   prevState.geoLocationState === \"Off\" &&\n        //   this.props.navigatingRoute.isSome()\n        //     ? 15\n        //     : undefined\n      });\n    }\n  }\n\n  render() {\n    const speed = Math.round(\n      this.state.position.fold(0, pos => {\n        // speed is in m/s\n        return pos.coords.speed ? (pos.coords.speed / 1000) * 3600 : 0;\n      })\n    );\n\n    const altitude = Math.round(\n      this.state.position.fold(0, pos => pos.coords.altitude || 0)\n    );\n\n    const showElevationProfile =\n      this.state.showElevationProfile && this.props.navigatingRoute.isSome();\n\n    return (\n      <View\n        className={cx(\"mapWithControls\", {\n          showElevationProfile,\n          showScale: this.props.scale\n        })}\n        height=\"100%\"\n        grow\n        column\n      >\n        <View className=\"info-wrapper\">\n          {this.props.speedometer && (\n            <View\n              className=\"speed-wrapper control-button\"\n              column\n              vAlignContent=\"center\"\n              hAlignContent=\"center\"\n            >\n              {speed}\n              <span className=\"unit\">km/h</span>\n            </View>\n          )}\n\n          {this.props.altimeter && (\n            <View\n              className=\"altitude-wrapper control-button\"\n              column\n              vAlignContent=\"center\"\n              hAlignContent=\"center\"\n            >\n              {altitude}\n              <span className=\"unit\">msl</span>\n            </View>\n          )}\n        </View>\n\n        <View column className=\"controls-wrapper\">\n          {this.props.altitudeControl && (\n            <View\n              className=\"toggle-elevation control-button\"\n              onClick={() => {\n                this.setState({\n                  showElevationProfile: !this.state.showElevationProfile\n                });\n              }}\n              hAlignContent=\"center\"\n              vAlignContent=\"center\"\n              style={{\n                background: this.state.showElevationProfile\n                  ? \"#f8f8f8\"\n                  : undefined\n              }}\n            >\n              <svg width=\"29\" height=\"29\" viewBox=\"0 0 15 15\">\n                <path\n                  id=\"path5571\"\n                  d=\"M7.5,2C7.2,2,7.1,2.2,6.9,2.4&#10;&#9;l-5.8,9.5C1,12,1,12.2,1,12.3C1,12.8,1.4,13,1.7,13h11.6c0.4,0,0.7-0.2,0.7-0.7c0-0.2,0-0.2-0.1-0.4L8.2,2.4C8,2.2,7.8,2,7.5,2z&#10;&#9; M7.5,3.5L10.8,9H10L8.5,7.5L7.5,9l-1-1.5L5,9H4.1L7.5,3.5z\"\n                  fill={this.state.showElevationProfile ? \"#5bb3e0\" : \"#393939\"}\n                />\n              </svg>\n            </View>\n          )}\n\n          {this.props.drinkingWaterControl && (\n            <View\n              className=\"toggle-drinking-water control-button\"\n              onClick={() => {\n                this.setState({\n                  showDrinkingWater: !this.state.showDrinkingWater\n                });\n              }}\n              hAlignContent=\"center\"\n              vAlignContent=\"center\"\n              style={{\n                background: this.state.showDrinkingWater ? \"#f8f8f8\" : undefined\n              }}\n            >\n              <DrinkingWaterMarker\n                color={this.state.showDrinkingWater ? \"#5bb3e0\" : \"#393939\"}\n              />\n            </View>\n          )}\n        </View>\n\n        {this.props.geoLocateControl && (\n          <View className=\"tracking-controls\">\n            <View\n              className=\"geo-locate control-button\"\n              vAlignContent=\"center\"\n              hAlignContent=\"center\"\n              onClick={this.onNorthTrackingClick}\n              style={{\n                background:\n                  this.state.geoLocationState === \"NorthTracking\"\n                    ? \"#f8f8f8\"\n                    : undefined\n              }}\n            >\n              {this.state.geoLocationState === \"North\" ? (\n                <svg\n                  width=\"25px\"\n                  height=\"25px\"\n                  viewBox=\"0 0 511.48 511.48\"\n                  fill=\"#5bb3e0\"\n                >\n                  <path d=\"M287.74,287.48c-8.832,0-16,7.168-16,16v60.224l-33.696-67.392c-0.352-0.704-0.96-1.152-1.376-1.76    c-0.672-0.96-1.28-1.952-2.176-2.752c-0.736-0.672-1.568-1.088-2.368-1.6c-0.928-0.576-1.792-1.216-2.816-1.6    c-0.992-0.384-2.016-0.448-3.072-0.608c-0.832-0.16-1.6-0.512-2.496-0.512c-0.192,0-0.352,0.096-0.544,0.096    c-0.992,0.032-1.92,0.384-2.912,0.608c-1.12,0.256-2.208,0.384-3.232,0.864c-0.16,0.064-0.32,0.032-0.48,0.128    c-0.704,0.352-1.152,0.96-1.792,1.408c-0.96,0.672-1.92,1.28-2.72,2.112c-0.704,0.768-1.152,1.632-1.664,2.496    c-0.544,0.864-1.152,1.696-1.536,2.688c-0.384,1.056-0.48,2.144-0.64,3.264c-0.128,0.8-0.48,1.504-0.48,2.336v128    c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16v-60.224l33.696,67.36c0.16,0.32,0.512,0.448,0.704,0.768    c1.152,1.952,2.656,3.584,4.512,4.896c0.544,0.384,1.024,0.768,1.632,1.088c2.24,1.248,4.704,2.112,7.456,2.112    c2.432,0,4.672-0.608,6.72-1.568c0.128-0.064,0.288-0.032,0.448-0.096c0.704-0.352,1.152-0.96,1.792-1.408    c0.96-0.672,1.92-1.28,2.72-2.112c0.704-0.736,1.152-1.632,1.664-2.496c0.544-0.896,1.152-1.696,1.536-2.688    c0.384-1.056,0.48-2.176,0.672-3.264c0.096-0.832,0.448-1.536,0.448-2.368v-128C303.74,294.648,296.572,287.48,287.74,287.48z\" />\n                  <path d=\"M255.74,223.48c-79.392,0-144,64.608-144,144s64.608,144,144,144s144-64.608,144-144S335.132,223.48,255.74,223.48z     M255.74,479.48c-61.76,0-112-50.24-112-112s50.24-112,112-112s112,50.24,112,112S317.5,479.48,255.74,479.48z\" />\n                  <path d=\"M397.084,216.088L269.404,7.128c-5.824-9.504-21.504-9.504-27.328,0l-127.68,208.96    c-4.16,6.784-2.656,15.616,3.456,20.704c6.208,5.056,15.104,4.832,21.024-0.544c31.552-28.864,73.056-44.768,116.864-44.768    s85.312,15.904,116.864,44.768c3.072,2.784,6.944,4.192,10.816,4.192c3.584,0,7.232-1.216,10.176-3.648    C399.74,231.704,401.244,222.872,397.084,216.088z M255.74,159.48c-27.36,0-54.016,5.28-78.592,15.296L255.74,46.168    l78.592,128.608C309.756,164.76,283.1,159.48,255.74,159.48z\" />\n                </svg>\n              ) : (\n                <svg\n                  width=\"25px\"\n                  height=\"25px\"\n                  viewBox=\"0 0 512 512\"\n                  fill={\n                    this.state.geoLocationState === \"NorthTracking\"\n                      ? \"#5bb3e0\"\n                      : \"#393939\"\n                  }\n                >\n                  <path\n                    d=\"M397.344,216.64L269.664,7.68C266.752,2.912,261.568,0,256,0s-10.752,2.912-13.664,7.648l-127.68,208.96\n\t\t\tc-4.16,6.784-2.656,15.616,3.488,20.704c6.112,5.024,15.072,4.832,20.96-0.544C170.688,207.904,212.224,192,256,192\n\t\t\ts85.312,15.904,116.896,44.768c5.856,5.344,14.784,5.568,20.96,0.544C400,232.224,401.504,223.392,397.344,216.64z\"\n                  />\n\n                  <path\n                    d=\"M256,224c-79.392,0-144,64.608-144,144s64.608,144,144,144s144-64.608,144-144S335.392,224,256,224z M304,432\n\t\t\tc0,7.392-5.088,13.888-12.32,15.552c-1.248,0.32-2.464,0.448-3.68,0.448c-5.984,0-11.552-3.328-14.304-8.832L240,371.776V432\n\t\t\tc0,8.832-7.168,16-16,16c-8.832,0-16-7.168-16-16V304c0-7.392,5.12-13.888,12.32-15.552c7.136-1.856,14.656,1.792,17.984,8.416\n\t\t\tL272,364.224V304c0-8.832,7.168-16,16-16c8.832,0,16,7.168,16,16V432z\"\n                  />\n                </svg>\n              )}\n            </View>\n\n            <View\n              className=\"compass-reset control-button\"\n              vAlignContent=\"center\"\n              hAlignContent=\"center\"\n              onClick={this.onCompassTrackingClick}\n              style={{\n                paddingTop: 5,\n                paddingRight: 8,\n                background:\n                  this.state.geoLocationState === \"NorthTracking\"\n                    ? \"#f8f8f8\"\n                    : undefined\n              }}\n            >\n              {this.state.geoLocationState === \"Compass\" ? (\n                <svg height=\"25\" viewBox=\"0 0 64 64\" width=\"25\" fill=\"#5bb3e0\">\n                  <path d=\"m32 28c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4zm0 6c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2z\" />\n                  <path d=\"m39.433 29.308-6.543-12.764c-.342-.668-1.438-.668-1.779 0l-6.543 12.764c-.016.03-.03.061-.042.093-.888 2.274-.648 4.782.657 6.88 1.325 2.128 3.533 3.473 6.06 3.688.249.02.502.031.757.031s.508-.011.76-.032c2.525-.215 4.733-1.56 6.058-3.688 1.306-2.098 1.545-4.605.657-6.88-.012-.032-.026-.062-.042-.092zm-2.313 5.915c-.989 1.588-2.64 2.592-4.528 2.753-.391.031-.796.031-1.183 0-1.89-.161-3.541-1.165-4.53-2.753-.96-1.542-1.145-3.381-.509-5.05l5.63-10.981 5.629 10.98c.636 1.67.451 3.509-.509 5.051z\" />\n                  <path d=\"m63 32c0-17.094-13.907-31-31-31s-31 13.906-31 31 13.907 31 31 31c4.451 0 8.736-.931 12.751-2.748 1.938 1.705 4.471 2.748 7.249 2.748 6.065 0 11-4.935 11-11 0-2.778-1.043-5.311-2.748-7.249 1.817-4.015 2.748-8.298 2.748-12.751zm-60 0c0-15.99 13.009-29 29-29s29 13.01 29 29c0 3.935-.775 7.729-2.291 11.302-1.055-.816-2.257-1.448-3.566-1.839 1.231-3 1.857-6.177 1.857-9.463 0-13.785-11.215-25-25-25s-25 11.215-25 25 11.215 25 25 25c3.286 0 6.462-.626 9.463-1.856.391 1.308 1.023 2.51 1.838 3.565-3.573 1.516-7.367 2.291-11.301 2.291-15.991 0-29-13.01-29-29zm38 20c0 .384.021.764.059 1.138-2.559 1.1-5.262 1.717-8.059 1.835v-2.973h-2v2.975c-11.888-.512-21.463-10.087-21.975-21.975h3.975v-2h-3.975c.512-11.888 10.087-21.463 21.975-21.975v3.975h2v-3.975c11.888.512 21.463 10.087 21.975 21.975h-3.975v2h3.973c-.118 2.797-.735 5.5-1.835 8.059-.374-.038-.754-.059-1.138-.059-6.065 0-11 4.935-11 11zm11 9c-4.962 0-9-4.037-9-9s4.038-9 9-9 9 4.037 9 9-4.038 9-9 9z\" />\n                  <path d=\"m54 53-4.2-5.6c-.258-.345-.708-.486-1.116-.349-.409.137-.684.518-.684.949v9h2v-6l4.2 5.6c.192.257.491.4.8.4.105 0 .212-.017.316-.052.409-.136.684-.517.684-.948v-9h-2z\" />\n                </svg>\n              ) : (\n                <svg\n                  height=\"25\"\n                  viewBox=\"0 0 64 64\"\n                  width=\"25\"\n                  fill={\n                    this.state.geoLocationState === \"CompassTracking\"\n                      ? \"#5bb3e0\"\n                      : \"#393939\"\n                  }\n                >\n                  <circle cx=\"32\" cy=\"32\" r=\"2\" />\n                  <path d=\"m32 19.192-5.629 10.98c-.636 1.669-.451 3.508.509 5.05.989 1.588 2.64 2.592 4.53 2.753.387.031.792.031 1.183 0 1.888-.161 3.539-1.165 4.528-2.753.96-1.542 1.145-3.381.509-5.05zm0 16.808c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4z\" />\n                  <path d=\"m32 57c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25c0 3.286-.626 6.463-1.857 9.463 1.308.391 2.51 1.023 3.566 1.839 1.516-3.573 2.291-7.367 2.291-11.302 0-15.99-13.009-29-29-29s-29 13.01-29 29 13.009 29 29 29c3.934 0 7.728-.775 11.302-2.292-.815-1.055-1.447-2.257-1.838-3.565-3.002 1.231-6.178 1.857-9.464 1.857z\" />\n                  <path d=\"m54.975 31c-.512-11.888-10.087-21.463-21.975-21.975v3.975h-2v-3.975c-11.888.512-21.463 10.087-21.975 21.975h3.975v2h-3.975c.512 11.888 10.087 21.463 21.975 21.975v-2.975h2v2.973c2.797-.118 5.5-.735 8.059-1.835-.038-.374-.059-.754-.059-1.138 0-6.065 4.935-11 11-11 .384 0 .764.021 1.139.059 1.1-2.559 1.717-5.262 1.835-8.059h-3.974v-2zm-16.157 5.28c-1.325 2.128-3.533 3.473-6.058 3.688-.252.021-.505.032-.76.032s-.508-.011-.758-.032c-2.527-.215-4.735-1.56-6.06-3.688-1.306-2.098-1.545-4.605-.657-6.88.012-.032.026-.062.042-.093l6.543-12.764c.342-.668 1.438-.668 1.779 0l6.543 12.764c.016.03.03.061.042.093.889 2.275.65 4.783-.656 6.88z\" />\n                  <path d=\"m52 43c-4.962 0-9 4.037-9 9s4.038 9 9 9 9-4.037 9-9-4.038-9-9-9zm4 13c0 .431-.275.812-.684.948-.104.035-.211.052-.316.052-.309 0-.607-.144-.8-.4l-4.2-5.6v6h-2v-9c0-.431.275-.812.684-.948.408-.138.858.004 1.116.349l4.2 5.599v-6h2z\" />\n                </svg>\n              )}\n            </View>\n          </View>\n        )}\n\n        {showElevationProfile && this.props.navigatingRoute.isSome() && (\n          <View className=\"elevation-profile-wrapper\">\n            <ElevationProfile\n              route={this.props.navigatingRoute.value}\n              activeRoutePointIndex={this.getClosestRoutePoint()\n                .map(activeRoutePointIndex => activeRoutePointIndex.index)\n\n                .toUndefined()}\n            />\n          </View>\n        )}\n\n        <View grow>\n          <Map\n            routes={this.props.routes}\n            startPosition={this.props.startPosition}\n            navigating={this.props.navigatingRoute.isSome()}\n            innerRef={this.updateInnerRef}\n            hoveredRoute={this.props.hoveredRoute}\n            selectedRoute={this.props.selectedRoute}\n            onRouteHover={this.props.onRouteHover}\n            onRouteSelect={this.props.onRouteSelect}\n            onSortRoutes={this.props.onSortRoutes}\n            showDrinkingWater={this.state.showDrinkingWater}\n          />\n        </View>\n      </View>\n    );\n  }\n}\n\nexport default MapWithControls;\n","import * as React from \"react\";\nimport cx from \"classnames\";\nimport View from \"../View\";\nimport { Route as RouteT, viewToLocation } from \"../../model\";\nimport { Option, some } from \"fp-ts/lib/Option\";\nimport Button from \"@buildo/bento/components/Button\";\nimport { doUpdateLocation } from \"../../commands\";\nimport { declareCommands } from \"react-avenger\";\n\nimport \"./sideBar.scss\";\nimport \"@buildo/bento/components/button.scss\";\n\nconst Route = (props: {\n  route: RouteT;\n  onClick: () => void;\n  isSelected: boolean;\n  onDetailsClick: (e: React.SyntheticEvent<HTMLDivElement, Event>) => void;\n}) => (\n  <View\n    className={cx(\"route\", { \"is-selected\": props.isSelected })}\n    column\n    onClick={props.onClick}\n    shrink={false}\n  >\n    <View className=\"name\">{props.route.properties.name}</View>\n    <View className=\"distance\" vAlignContent=\"bottom\">\n      <label>Distance</label> {props.route.properties.length} km\n    </View>\n    <View className=\"min-elevation\" vAlignContent=\"bottom\">\n      <label>Elev (min)</label>{\" \"}\n      {Math.round(props.route.properties.minElevation)} m\n    </View>\n    <View className=\"max-elevation\" vAlignContent=\"bottom\">\n      <label>Elev (max)</label>{\" \"}\n      {Math.round(props.route.properties.maxElevation)} m\n    </View>\n\n    <View className=\"actions\">\n      <Button size=\"tiny\" label=\"Details\" onClick={props.onDetailsClick} />\n    </View>\n  </View>\n);\n\nconst commands = declareCommands({ doUpdateLocation });\n\ntype Props = typeof commands.Props & {\n  routes: RouteT[];\n  onRouteClick: (route: RouteT) => void;\n  selectedRoute: Option<RouteT>;\n};\n\nclass SideBar extends React.PureComponent<Props> {\n  render() {\n    return (\n      <View className=\"side-bar\" column shrink={false}>\n        <View column shrink={false} className=\"navigationGpx\">\n          <h2>Navigation (GPX)</h2>\n\n          <input\n            type=\"file\"\n            accept=\".gpx\"\n            onChange={e => {\n              const file = e.target.files![0];\n\n              const reader = new FileReader();\n              reader.addEventListener(\"load\", event => {\n                localStorage.setItem(\"gpxFile\", event.target!.result as any);\n\n                this.props.doUpdateLocation(\n                  viewToLocation({ view: \"navigation\", routeId: some(\"gpx\") })\n                );\n              });\n              reader.readAsText(file);\n            }}\n          />\n        </View>\n\n        <View column shrink={false} className=\"routes\">\n          <h2>Routes</h2>\n          {this.props.routes.map((route, index) => (\n            <Route\n              key={index}\n              route={route}\n              onClick={() => this.props.onRouteClick(route)}\n              isSelected={\n                this.props.selectedRoute.isSome() &&\n                this.props.selectedRoute.value === route\n              }\n              onDetailsClick={e => {\n                e.stopPropagation();\n                this.props.doUpdateLocation(\n                  viewToLocation({ view: \"details\", routeId: some(route.id) })\n                );\n              }}\n            />\n          ))}\n        </View>\n      </View>\n    );\n  }\n}\n\nexport default commands(SideBar);\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { routes } from \"../../queries\";\nimport View from \"../View\";\nimport { getRouteDistanceInPixels } from \"../Map/Map\";\nimport MapWithControls from \"../MapWithControls/MapWithControls\";\nimport SideBar from \"../SideBar/SideBar\";\nimport { Route } from \"../../model\";\nimport { Option, none, some } from \"fp-ts/lib/Option\";\nimport sortBy from \"lodash/sortBy\";\n\nimport \"./explorer.scss\";\n\nconst queries = declareQueries({ routes });\n\ntype Props = typeof queries.Props;\n\ntype State = {\n  selectedRoute: Option<Route>;\n  hoveredRoute: Option<Route>;\n};\n\nclass Explorer extends React.Component<Props, State> {\n  map: Option<mapboxgl.Map> = none;\n\n  state: State = {\n    selectedRoute: none,\n    hoveredRoute: none\n  };\n\n  onRouteSelect = (route: Route) => {\n    this.setState({\n      selectedRoute:\n        this.state.selectedRoute.isSome() &&\n        this.state.selectedRoute.value === route\n          ? none\n          : some(route)\n    });\n  };\n\n  onRouteHover = (route: Option<Route>) => {\n    this.setState({\n      hoveredRoute: route\n    });\n  };\n\n  onSortRoutes = () => {\n    this.forceUpdate();\n  };\n\n  updateInnerRef = (map: mapboxgl.Map) => {\n    if (this.map.isNone()) {\n      this.map = some(map);\n      this.forceUpdate();\n    }\n  };\n\n  render() {\n    return this.props.routes.fold(\n      null,\n      () => null,\n      routes => {\n        const sortedRoutes: Route[] = this.map.fold(routes, map =>\n          sortBy(routes, route =>\n            getRouteDistanceInPixels(route, map.getCenter(), map)\n          )\n        );\n\n        return (\n          <View className=\"explorer\" grow>\n            <SideBar\n              routes={sortedRoutes}\n              onRouteClick={this.onRouteSelect}\n              selectedRoute={this.state.selectedRoute}\n            />\n            <MapWithControls\n              routes={routes}\n              selectedRoute={this.state.selectedRoute}\n              hoveredRoute={this.state.hoveredRoute}\n              onRouteHover={this.onRouteHover}\n              onRouteSelect={this.onRouteSelect}\n              onSortRoutes={this.onSortRoutes}\n              innerRef={this.updateInnerRef}\n              startPosition=\"userLocation\"\n              navigatingRoute={none}\n              noSleep={false}\n              altimeter={false}\n              altitudeControl={false}\n              drinkingWaterControl={false}\n              geoLocateControl\n              speedometer={false}\n              scale={false}\n            />\n          </View>\n        );\n      }\n    );\n  }\n}\n\nexport default queries(Explorer);\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { route, routeReadme } from \"../../queries\";\nimport View from \"../View\";\nimport MapWithControls from \"../MapWithControls/MapWithControls\";\nimport * as RemarkableModule from \"remarkable\";\nimport { none, some } from \"fp-ts/lib/Option\";\nimport { Route, viewToLocation } from \"../../model\";\nimport Button from \"@buildo/bento/components/Button\";\nimport { saveAs } from \"file-saver\";\nimport { Carousel } from \"react-responsive-carousel\";\nimport { declareCommands } from \"react-avenger\";\nimport { doUpdateLocation } from \"../../commands\";\nimport ElevationProfile from \"../ElevationProfile\";\nimport memoize from \"memoize-one\";\n\nimport \"react-responsive-carousel/lib/styles/carousel.min.css\";\nimport \"./details.scss\";\n\nconst { linkify } = require(\"remarkable/linkify\");\n\nconst togpx = require(\"togpx\");\n\nconst { Remarkable } = RemarkableModule;\n\nconst saveGPX = (route: Route): void => {\n  const blob = new Blob([togpx(route)], {\n    type: \"text/plain;charset=utf-8\"\n  });\n\n  saveAs(blob, `${route.properties.name}.gpx`);\n};\n\nclass Markdown extends React.PureComponent<{\n  routeReadme: string;\n  route: Route;\n  onEnterNavigation: () => void;\n}> {\n  componentDidMount() {\n    this.forceUpdate();\n  }\n\n  render() {\n    const images = Array.from(\n      document.querySelectorAll<HTMLImageElement>(\".remarkable img\")\n    );\n\n    const h1 = document.querySelector<HTMLElement>(\n      \".remarkable h1:first-of-type\"\n    );\n\n    return (\n      <View className=\"markdown\" hAlignContent=\"center\" shrink={false}>\n        <View className=\"wrapper\" grow>\n          <View grow column style={{ position: \"relative\" }}>\n            <View className=\"title\">{h1?.innerText}</View>\n            <View className=\"actions\">\n              <Button\n                flat\n                size=\"medium\"\n                label=\"Enter Navigation\"\n                onClick={this.props.onEnterNavigation}\n              />\n              <Button\n                flat\n                size=\"medium\"\n                label=\"Download GPX\"\n                onClick={() => saveGPX(this.props.route)}\n              />\n            </View>\n\n            <div\n              className=\"remarkable\"\n              dangerouslySetInnerHTML={{\n                __html: md.render(this.props.routeReadme)\n              }}\n            />\n\n            <View className=\"summary\">\n              <View className=\"distance\" column shrink={false}>\n                <span>{this.props.route.properties.length} km</span>\n                <label>Distance</label>\n              </View>\n              <View className=\"min-elevation\" column shrink={false}>\n                <span>\n                  {Math.round(this.props.route.properties.minElevation)} m\n                </span>\n                <label>Min elevation</label>\n              </View>\n              <View className=\"max-elevation\" column shrink={false}>\n                <span>\n                  {Math.round(this.props.route.properties.maxElevation)} m\n                </span>\n                <label>Max elevation</label>\n              </View>\n            </View>\n          </View>\n          <View className=\"images\" hAlignContent=\"right\" shrink={false}>\n            <Carousel\n              showThumbs={false}\n              showStatus={false}\n              showIndicators={images.length > 1}\n              infiniteLoop\n              autoPlay\n              interval={6000}\n            >\n              {images.map(image => (\n                <img key={image.src} src={image.src} alt={image.src} />\n              ))}\n            </Carousel>\n          </View>\n          <View className=\"mobile-images\" grow>\n            {images.slice(0, 2).map(image => (\n              <img key={image.src} src={image.src} alt={image.src} />\n            ))}\n          </View>\n        </View>\n      </View>\n    );\n  }\n}\n\nconst md = new Remarkable().use(linkify);\n\nconst queries = declareQueries({ route, routeReadme });\nconst commands = declareCommands({ doUpdateLocation });\n\ntype Props = typeof queries.Props & typeof commands.Props;\n\nclass Details extends React.Component<Props> {\n  getRoutes = memoize(\n    (route: Route) => {\n      return [route];\n    },\n    (newArgs: Route[], prevArgs: Route[]): boolean =>\n      newArgs[0].id === prevArgs[0].id\n  );\n\n  render() {\n    return this.props.route.fold(\n      null,\n      () => null,\n      route =>\n        this.props.routeReadme.fold(\n          null,\n          () => null,\n          routeReadme => {\n            if (route.isNone() || routeReadme.isNone()) {\n              return null;\n            } else {\n              return (\n                <View className=\"details\" height=\"100%\" grow column>\n                  <Markdown\n                    routeReadme={routeReadme.value}\n                    route={route.value}\n                    onEnterNavigation={() => {\n                      this.props.doUpdateLocation(\n                        viewToLocation({\n                          view: \"navigation\",\n                          routeId: some(route.value.id)\n                        })\n                      );\n                    }}\n                  />\n\n                  <View shrink={false} className=\"map-wrapper\">\n                    <MapWithControls\n                      routes={this.getRoutes(route.value)}\n                      startPosition=\"firstRoute\"\n                      navigatingRoute={none}\n                      hoveredRoute={route} // fixed blue color that is easily visible\n                      selectedRoute={none}\n                      altimeter={false}\n                      altitudeControl={false}\n                      drinkingWaterControl={false}\n                      geoLocateControl\n                      noSleep={false}\n                      speedometer={false}\n                      scale={false}\n                    />\n                  </View>\n                  <View className=\"elevation-profile-wrapper\" shrink={false}>\n                    <ElevationProfile route={route.value} />\n                  </View>\n                </View>\n              );\n            }\n          }\n        )\n    );\n  }\n}\n\nexport default commands(queries(Details));\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { route } from \"../../queries\";\nimport View from \"../View\";\nimport { none } from \"fp-ts/lib/Option\";\nimport { declareCommands } from \"react-avenger\";\nimport { doUpdateLocation } from \"../../commands\";\nimport memoize from \"memoize-one\";\nimport { Route } from \"../../model\";\nimport MapWithControls from \"../MapWithControls/MapWithControls\";\nimport mobileDetect from \"@buildo/bento/utils/mobileDetect\";\n\nimport \"react-responsive-carousel/lib/styles/carousel.min.css\";\n\nconst md = mobileDetect();\n\ntype x = typeof none;\n\nconst queries = declareQueries({ route });\nconst commands = declareCommands({ doUpdateLocation });\n\ntype Props = typeof queries.Props & typeof commands.Props;\n\nclass Navigation extends React.Component<Props> {\n  getRoutes = memoize(\n    (route: Route) => {\n      return [route];\n    },\n    (newArgs: Route[], prevArgs: Route[]): boolean =>\n      newArgs[0].id === prevArgs[0].id\n  );\n\n  render() {\n    return this.props.route.fold(\n      null,\n      () => null,\n      route => {\n        if (route.isNone()) {\n          return null;\n        } else {\n          return (\n            <View className=\"navigation\" height=\"100%\" grow column>\n              <MapWithControls\n                routes={this.getRoutes(route.value)}\n                navigatingRoute={route}\n                altimeter={!md.isDesktop}\n                altitudeControl\n                drinkingWaterControl\n                noSleep\n                scale\n                speedometer={!md.isDesktop}\n                geoLocateControl\n                startPosition=\"firstRoute\"\n                hoveredRoute={none}\n                selectedRoute={none}\n              />\n            </View>\n          );\n        }\n      }\n    );\n  }\n}\n\nexport default commands(queries(Navigation));\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (\"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl, { scope: \"/fontanelle/\" })\n    .then(registration => {\n      console.log(registration.scope);\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React, { FC, useEffect } from \"react\";\nimport * as serviceWorker from \"../serviceWorkerRegistration\";\nimport View from \"./View\";\nimport { none, Option, fromNullable } from \"fp-ts/lib/Option\";\n\n// Learn more about service workers: https://bit.ly/CRA-PWA\n\nconst ServiceWorkerWrapper: FC = () => {\n  const [showReload, setShowReload] = React.useState(false);\n  const [waitingWorker, setWaitingWorker] = React.useState<\n    Option<ServiceWorker>\n  >(none);\n\n  const onSWUpdate = (registration: ServiceWorkerRegistration) => {\n    setShowReload(true);\n    setWaitingWorker(fromNullable(registration.waiting));\n  };\n\n  useEffect(() => {\n    serviceWorker.register({ onUpdate: onSWUpdate });\n  }, []);\n\n  const reloadPage = () => {\n    console.log(\"reload page\");\n    waitingWorker.map(ww => ww.postMessage({ type: \"SKIP_WAITING\" }));\n    setShowReload(false);\n    window.location.reload(true);\n  };\n\n  return showReload ? (\n    <View\n      className=\"updateAvailable\"\n      vAlignContent=\"center\"\n      hAlignContent=\"center\"\n      style={{\n        background: \"lightgreen\",\n        height: 25,\n        color: \"black\"\n      }}\n    >\n      Update Available\n      <span\n        style={{\n          marginLeft: 60,\n          textDecoration: \"underline\",\n          cursor: \"pointer\"\n        }}\n        onClick={() => reloadPage()}\n      >\n        Install\n      </span>\n      <span\n        style={{\n          marginLeft: 20,\n          textDecoration: \"underline\",\n          cursor: \"pointer\"\n        }}\n        onClick={() => {\n          console.log(\"ignore\");\n          setShowReload(false);\n        }}\n      >\n        Ignore\n      </span>\n    </View>\n  ) : null;\n};\n\nexport default ServiceWorkerWrapper;\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { currentView } from \"../../queries\";\nimport View from \"../View\";\nimport Explorer from \"../Explorer/Explorer\";\nimport Details from \"../Details/Details\";\nimport Navigation from \"../Navigation/Navigation\";\nimport mapboxgl from \"mapbox-gl\";\nimport ServiceWorkerWrapper from \"../ServiceWorkerWrapper\";\n\nmapboxgl.prewarm();\n\nconst queries = declareQueries({ currentView });\n\ntype Props = typeof queries.Props;\n\nclass App extends React.Component<Props> {\n  render() {\n    return this.props.currentView.fold(\n      null,\n      () => null,\n      currentView => (\n        <View className=\"app\" height=\"100%\" column>\n          <ServiceWorkerWrapper />\n          {currentView.view === \"explorer\" && <Explorer />}\n          {currentView.view === \"details\" && <Details />}\n          {currentView.view === \"navigation\" && <Navigation />}\n        </View>\n      )\n    );\n  }\n}\n\nexport default queries(App);\n","import App from './App';\nexport default App;\n","// This script adds \"is-desktop\", \"is-phone\" or \"is-tablet\" class to the root document element\n\nimport cx from \"classnames\";\nimport mobileDetect from \"@buildo/bento/utils/mobileDetect\";\n\nconst md = mobileDetect();\n\nconst deviceClassName = cx({\n  \"is-desktop\": md.isDesktop,\n  \"is-tablet\": md.isTablet,\n  \"is-phone\": md.isPhone\n});\n\n// document.documentElement is not supported in every browser, fallback on document.body\nconst body = document.documentElement || document.body;\n\nbody.className = cx(body.className, deviceClassName);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\n\nimport \"./setup/addDeviceClassName\";\nimport \"./theme\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"app\")\n);\n"],"sourceRoot":""}