{"version":3,"sources":["queries/index.ts","model/index.ts","components/View/index.ts","components/View/View.ts","components/Popup/Popup.tsx","components/Marker/Marker.tsx","components/Map/Map.tsx","components/SideBar/SideBar.tsx","components/Explorer/Explorer.tsx","components/FullscreenModal/FullscreenModal.tsx","components/Details/Details.tsx","components/App/index.ts","components/App/App.tsx","serviceWorker.ts","setup/addDeviceClassName.ts","index.tsx"],"names":["currentView","Query","params","dependencies","location","fetch","Promise","resolve","search","view","routeId","fromNullable","locationToView","routes","cacheStrategy","available","then","res","json","JSON","parse","body","features","map","feature","coordinates","minElevation","geometry","reduce","acc","c","Number","MAX_SAFE_INTEGER","maxElevation","MIN_SAFE_INTEGER","id","properties","url","color","stringToColor","name","length","Math","round","geoJsonLength","elevationGain","filter","index","prevAltitude","undefined","altitude","route","isSome","value","find","r","none","routeReadme","exec","readmeUrl","text","some","View","props","className","column","vAlignContent","height","width","viewBox","onClick","style","cursor","marginTop","fillRule","transform","fill","opacity","cx","cy","rx","ry","d","md","mobileDetect","popupSettings","closeButton","closeOnClick","offset","anchor","getRouteDistanceInPixels","lngLat","point","project","mapboxgl","lng","lat","routePoint","distance","sqrt","pow","abs","x","y","Infinity","App","popupSelectedRoute","popupHoveredRoute","positionWatch","centerUserLocation","document","querySelector","el","click","onMouseMove","throttle","e","closestRoute","onRouteHover","onFullscreenChange","fullscreenElement","scrollZoom","enable","disable","container","center","parseFloat","localStorage","getItem","zoom","on","addLayers","addMarkers","startPosition","flyToRoute","animate","padding","isDesktop","this","innerRef","addControl","positionOptions","enableHighAccuracy","trackUserLocation","showUserLocation","showAccuracyCircle","fitBoundsOptions","maxZoom","showZoom","showCompass","selectedRoute","hoveredRoute","forEach","layer","type","source","data","layout","paint","getRouteColor","onRouteSelect","addLayer","element","createElement","ReactDOM","Marker","setLngLat","addTo","setPaintProperty","options","bounds","coord","extend","fitBounds","popup","latLng","setHTML","ReactDOMServer","Popup","showPopup","remove","fold","identity","initializeMap","addEventListener","navigator","geolocation","watchPosition","position","setItem","String","coords","latitude","longitude","prevProps","updateLayers","updateSelectedRoutePopup","updateHoveredRoutePopup","isNone","navigating","setTimeout","resize","clearWatch","removeEventListener","grow","isNavigating","React","Route","isSelected","shrink","size","label","onDetailsClick","commands","declareCommands","doUpdateLocation","key","onRouteClick","stopPropagation","pathname","getOrElse","viewToLocation","queries","declareQueries","state","setState","sortedRoutes","sortBy","getCenter","Map","forceUpdate","fullscreen","documentHidden","time","FullscreenModal","showModal","onVisibilityChange","Date","now","hidden","enterFullscreen","getElementById","requestFullscreen","onDismiss","transitionEnterTimeout","transitionLeaveTimeout","iconClose","title","footer","justifyContent","primary","noSleep","NoSleep","linkify","require","defaults","global","animation","togpx","Remarkable","RemarkableModule","Markdown","images","Array","from","querySelectorAll","h1","hAlignContent","onExitNavigation","innerText","flat","onEnterNavigation","blob","Blob","saveAs","saveGPX","dangerouslySetInnerHTML","__html","render","showThumbs","showStatus","showIndicators","infiniteLoop","autoPlay","interval","image","src","alt","slice","use","scale","distances","_","i","ticks","uniq","number","roundedInteger","remainder","discriminatingFactor","flooredNumber","elevations","datasets","pointRadius","borderWidth","yAxisID","xAxisID","responsive","maintainAspectRatio","scales","xAxes","labels","toFixed","display","callback","yAxes","precision","maxRotation","stepSize","suggestedMin","suggestedMax","tooltips","mode","intersect","callbacks","tooltipItems","legend","Boolean","window","hostname","match","deviceClassName","isTablet","isPhone","documentElement","StrictMode","serviceWorker","ready","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.9abc616e.chunk.js","sourcesContent":["import { Query, location, available } from \"@buildo/bento/data\";\nimport { locationToView, Geometry, Route, GeoJSONFeature } from \"../model\";\nimport * as stringToColor from \"string-to-color\";\nimport * as geoJsonLength from \"geojson-length\";\nimport { Option, fromNullable, none, some } from \"fp-ts/lib/Option\";\n\nfunction getElevationGain(coordinates: Geometry[\"coordinates\"]): number {\n  return coordinates\n    .filter(c => c[2])\n    .reduce((acc, c, index) => {\n      const prevAltitude = index > 0 ? coordinates[index - 1][2] : undefined;\n      const altitude = c[2]!;\n\n      if (prevAltitude && altitude > prevAltitude) {\n        return acc + altitude - prevAltitude;\n      }\n\n      return acc;\n    }, 0);\n}\n\nexport { location };\n\nexport const currentView = Query({\n  params: {},\n  dependencies: { location: location },\n  fetch: ({ location }) => Promise.resolve(locationToView(location))\n});\n\nexport const routes = Query({\n  cacheStrategy: available,\n  params: {},\n  fetch: (): Promise<Route[]> =>\n    fetch(\n      `${\n        process.env.NODE_ENV === \"development\"\n          ? \"http://localhost:8081/\"\n          : \"https://or52hotxz1.execute-api.us-east-1.amazonaws.com/dev/\"\n      }`\n    )\n      .then(res => res.json() as Promise<{ body: string }>)\n      .then((res): GeoJSONFeature[] => JSON.parse(res.body))\n      .then(features =>\n        features.map(feature => {\n          const minElevation = feature.geometry.coordinates.reduce(\n            (acc: number, c) => (c[2] && c[2] < acc ? c[2] : acc),\n            Number.MAX_SAFE_INTEGER\n          );\n\n          const maxElevation = feature.geometry.coordinates.reduce(\n            (acc: number, c) => (c[2] && c[2] > acc ? c[2] : acc),\n            Number.MIN_SAFE_INTEGER\n          );\n\n          const richFeature: Route = {\n            id: feature.properties.url,\n            ...feature,\n            properties: {\n              ...feature.properties,\n              color: stringToColor(feature.properties.name),\n              length: Math.round(geoJsonLength(feature.geometry) / 100) / 10,\n              elevationGain: Math.round(\n                getElevationGain(feature.geometry.coordinates)\n              ),\n              minElevation,\n              maxElevation\n            }\n          };\n\n          return richFeature;\n        })\n      )\n});\n\nexport const route = Query({\n  params: {},\n  dependencies: { currentView, routes },\n  fetch: ({ currentView, routes }): Promise<Option<Route>> => {\n    if (currentView.view === \"details\" && currentView.routeId.isSome()) {\n      const routeId = currentView.routeId.value;\n      return Promise.resolve(fromNullable(routes.find(r => r.id === routeId)));\n    }\n\n    return Promise.resolve(none);\n  }\n});\n\nexport const routeReadme = Query({\n  params: {},\n  dependencies: { route },\n  fetch: ({ route }): Promise<Option<string>> => {\n    if (route.isSome()) {\n      const res = /BikeRoutes.+master\\/(.+)\\/.+$/.exec(\n        route.value.properties.url\n      )!;\n\n      const readmeUrl = `https://raw.githubusercontent.com/BikeRoutes/BikeRoutes/master/${res[1]}/README.md`;\n\n      return fetch(readmeUrl)\n        .then(r => r.text())\n        .then(text => some(text));\n    }\n    return Promise.resolve(none);\n  }\n});\n","import { HistoryLocation as HistoryLocationT } from \"@buildo/bento/data\";\nimport { Option, fromNullable } from \"fp-ts/lib/Option\";\n\nexport type HistoryLocation = HistoryLocationT;\n\nexport type CurrentView =\n  | { view: \"explorer\" }\n  | { view: \"details\"; routeId: Option<string> };\n\nexport function locationToView(location: HistoryLocation): CurrentView {\n  switch (location.search.view) {\n    case \"details\":\n      return {\n        view: \"details\",\n        routeId: fromNullable(location.search.routeId)\n      };\n    default:\n      return { view: \"explorer\" };\n  }\n}\n\nexport function viewToLocation(view: CurrentView): HistoryLocation {\n  switch (view.view) {\n    case \"details\":\n      return {\n        pathname: \"/Explorer\",\n        search: { view: \"details\", routeId: view.routeId.getOrElse(\"\") }\n      };\n    case \"explorer\":\n      return { pathname: \"/Explorer\", search: {} };\n  }\n}\n\nexport type Content = {\n  name: string;\n  type: \"dir\" | \"file\";\n  url: string;\n  download_url: string;\n  html_url: string;\n};\n\nexport type Geometry = {\n  type: \"LineString\";\n  coordinates: Array<[number, number, number?]>;\n};\n\nexport type GeoJSONFeature = {\n  type: \"Feature\";\n  properties: {\n    name: string;\n    color: string;\n    length: number;\n    elevationGain: number;\n    minElevation: number;\n    maxElevation: number;\n    url: string;\n  };\n  geometry: Geometry;\n};\nexport type GeoJSONFeatureCollection = {\n  type: \"FeatureCollection\";\n  features: GeoJSONFeature[];\n};\n\nexport type Route = GeoJSONFeature & { id: string };\n","import View from './View';\nexport default View;\n","import View from '@buildo/bento/components/FlexView';\nexport default View;\n","import * as React from \"react\";\nimport View from \"../View\";\nimport { Route } from \"../../model\";\n\nimport \"./popup.scss\";\n\nexport default (props: { route: Route }) => (\n  <View className=\"popup\" column>\n    <View className=\"name\">{props.route.properties.name}</View>\n    <View className=\"distance\" vAlignContent=\"bottom\">\n      <label>Distance</label> {props.route.properties.length} km\n    </View>\n    <View className=\"elevation\" vAlignContent=\"bottom\">\n      <label>Elevation</label> {props.route.properties.elevationGain} m\n    </View>\n  </View>\n);\n","import * as React from \"react\";\n\nexport default (props: { onClick: () => void }) => (\n  <svg\n    height=\"41px\"\n    width=\"27px\"\n    viewBox=\"0 0 27 41\"\n    onClick={props.onClick}\n    className=\"marker\"\n    style={{ cursor: \"pointer\", marginTop: \"-100%\" }}\n  >\n    <g fillRule=\"nonzero\">\n      <g transform=\"translate(3.0, 29.0)\" fill=\"#000000\">\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"10.5\"\n          ry=\"5.25002273\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"10.5\"\n          ry=\"5.25002273\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"9.5\"\n          ry=\"4.77275007\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"8.5\"\n          ry=\"4.29549936\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"7.5\"\n          ry=\"3.81822308\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"6.5\"\n          ry=\"3.34094679\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"5.5\"\n          ry=\"2.86367051\"\n        />\n        <ellipse\n          opacity=\"0.04\"\n          cx=\"10.5\"\n          cy=\"5.80029008\"\n          rx=\"4.5\"\n          ry=\"2.38636864\"\n        />\n      </g>\n      <g fill=\"#3FB1CE\">\n        <path d=\"M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z\" />\n      </g>\n      <g opacity=\"0.25\" fill=\"#000000\">\n        <path d=\"M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z\" />\n      </g>\n      <g transform=\"translate(6.0, 7.0)\" fill=\"#FFFFFF\" />\n      <g transform=\"translate(8.0, 8.0)\">\n        <circle fill=\"#000000\" opacity=\"0.25\" cx=\"5.5\" cy=\"5.5\" r=\"5.4999962\" />\n        <circle fill=\"#FFFFFF\" cx=\"5.5\" cy=\"5.5\" r=\"5.4999962\" />\n      </g>\n    </g>\n  </svg>\n);\n","import * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\nimport * as ReactDOM from \"react-dom\";\nimport throttle from \"lodash/throttle\";\nimport * as mapboxgl from \"mapbox-gl\";\nimport Popup from \"../Popup/Popup\";\nimport Marker from \"../Marker/Marker\";\nimport View from \"../View\";\nimport { Option, none, some, fromNullable } from \"fp-ts/lib/Option\";\nimport { Route } from \"../../model\";\nimport mobileDetect from \"@buildo/bento/utils/mobileDetect\";\nimport { identity } from \"fp-ts/lib/function\";\nimport cx from \"classnames\";\n\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"./map.scss\";\n\n/* eslint-disable array-callback-return */\n\nconst md = mobileDetect();\n\nconst popupSettings: mapboxgl.PopupOptions = {\n  closeButton: false,\n  closeOnClick: false,\n  offset: [0, -40],\n  anchor: \"bottom\"\n};\n\nexport const getRouteDistanceInPixels = (\n  route: Route,\n  lngLat: mapboxgl.LngLat,\n  map: mapboxgl.Map\n): number => {\n  return route.geometry.coordinates.reduce((acc, coordinates) => {\n    const point = map.project(new mapboxgl.LngLat(lngLat.lng, lngLat.lat));\n    const routePoint = map.project(\n      new mapboxgl.LngLat(coordinates[0], coordinates[1])\n    );\n    const distance = Math.sqrt(\n      Math.pow(Math.abs(point.x - routePoint.x), 2) +\n        Math.pow(Math.abs(point.y - routePoint.y), 2)\n    );\n    return distance < acc ? distance : acc;\n  }, Infinity);\n};\n\ntype Props = {\n  routes: Route[];\n  selectedRoute: Option<Route>;\n  hoveredRoute: Option<Route>;\n  onRouteHover: (route: Option<Route>) => void;\n  onRouteSelect: (route: Route) => void;\n  innerRef: (map: Option<mapboxgl.Map>) => void;\n  startPosition: \"userLocation\" | \"firstRoute\";\n  navigating: boolean;\n};\n\nclass App extends React.PureComponent<Props> {\n  map: Option<mapboxgl.Map> = none;\n  popupSelectedRoute: mapboxgl.Popup = new mapboxgl.Popup(popupSettings);\n  popupHoveredRoute: mapboxgl.Popup = new mapboxgl.Popup(popupSettings);\n  positionWatch: Option<number> = none;\n\n  centerUserLocation = () => {\n    fromNullable(\n      document.querySelector<HTMLButtonElement>(\n        \".mapboxgl-ctrl-geolocate:not(.mapboxgl-ctrl-geolocate-active)\"\n      )\n    ).map(el => el.click());\n  };\n\n  initializeMap() {\n    (mapboxgl as any).accessToken =\n      \"pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw\";\n\n    const map = new mapboxgl.Map({\n      container: \"map\",\n      style: \"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm\",\n      center: {\n        lat: parseFloat(localStorage.getItem(\"start_lat\") || \"0\"),\n        lng: parseFloat(localStorage.getItem(\"start_lng\") || \"0\")\n      },\n      zoom: 11.0,\n      scrollZoom: false\n    });\n\n    map.on(\"load\", () => {\n      this.map = some(map);\n\n      this.addLayers();\n      this.addMarkers();\n\n      if (this.props.startPosition === \"userLocation\") {\n        this.centerUserLocation();\n      }\n\n      if (\n        this.props.startPosition === \"firstRoute\" &&\n        this.props.routes.length > 0\n      ) {\n        this.flyToRoute(this.props.routes[0], { animate: false, padding: 80 });\n      }\n    });\n\n    if (md.isDesktop) {\n      map.on(\"mousemove\", this.onMouseMove);\n    }\n\n    map.on(\"moveend\", () => this.props.innerRef(this.map));\n\n    // map.addControl(new mapboxgl.FullscreenControl());\n\n    map.addControl(\n      new mapboxgl.GeolocateControl({\n        positionOptions: {\n          enableHighAccuracy: true\n        },\n        trackUserLocation: true,\n        showUserLocation: true,\n        showAccuracyCircle: true,\n\n        fitBoundsOptions: {\n          maxZoom: this.props.startPosition === \"firstRoute\" ? 15 : 11\n        }\n      })\n    );\n\n    map.addControl(\n      new mapboxgl.NavigationControl({\n        showZoom: md.isDesktop,\n        showCompass: !md.isDesktop\n      })\n    );\n  }\n\n  getRouteColor(route: Route): string {\n    return (this.props.selectedRoute.isSome() &&\n      route === this.props.selectedRoute.value) ||\n      (this.props.hoveredRoute.isSome() &&\n        route === this.props.hoveredRoute.value)\n      ? \"#387ddf\"\n      : route.properties.color;\n  }\n\n  addLayers() {\n    this.map.map(map => {\n      this.props.routes.forEach(route => {\n        const layer: mapboxgl.Layer = {\n          id: route.properties.url,\n          type: \"line\",\n          source: {\n            type: \"geojson\",\n            data: route as any\n          },\n          layout: {\n            \"line-join\": \"round\",\n            \"line-cap\": \"round\"\n          },\n          paint: {\n            \"line-width\": 3,\n            \"line-color\": this.getRouteColor(route)\n          }\n        };\n\n        map.on(\"click\", layer.id, () => {\n          this.props.onRouteSelect(route);\n        });\n\n        map.addLayer(layer);\n      });\n    });\n  }\n\n  addMarkers() {\n    this.map.map(map => {\n      this.props.routes.forEach(route => {\n        const coordinates = route.geometry.coordinates[0];\n\n        const element = document.createElement(\"div\");\n        ReactDOM.render(\n          <Marker onClick={() => this.props.onRouteSelect(route)} />,\n          element\n        );\n\n        const marker: mapboxgl.Marker = new mapboxgl.Marker({\n          element\n        }).setLngLat([coordinates[0], coordinates[1]]);\n\n        marker.addTo(map);\n      });\n    });\n  }\n\n  onMouseMove = throttle((e: mapboxgl.MapMouseEvent) => {\n    type ClosestRoute = {\n      distance: number;\n      route: Route;\n    };\n\n    this.map.map(map => {\n      const closestRoute: ClosestRoute = this.props.routes.reduce(\n        (acc, route) => {\n          const distance = getRouteDistanceInPixels(route, e.lngLat, map);\n\n          return distance < acc.distance ? { distance, route } : acc;\n        },\n        { distance: Infinity } as ClosestRoute\n      );\n\n      if (closestRoute.distance < 25) {\n        this.props.onRouteHover(some(closestRoute.route));\n      } else {\n        this.props.onRouteHover(none);\n      }\n    });\n  }, 60);\n\n  updateLayers() {\n    this.map.map(map => {\n      this.props.routes.forEach(route => {\n        // update color\n        map.setPaintProperty(route.id, \"line-color\", this.getRouteColor(route));\n      });\n    });\n  }\n\n  flyToRoute(route: Route, options?: mapboxgl.FitBoundsOptions) {\n    this.map.map(map => {\n      const coordinates = route.geometry.coordinates as [number, number][];\n      const bounds = coordinates\n        .map(coord => new mapboxgl.LngLatBounds(coord, coord))\n        .reduce((bounds, coord) => {\n          return bounds.extend(coord);\n        });\n\n      map.fitBounds(bounds, { padding: 50, ...options });\n    });\n  }\n\n  showPopup(route: Route, popup: mapboxgl.Popup) {\n    this.map.map(map => {\n      const latLng: mapboxgl.LngLat = new mapboxgl.LngLat(\n        route.geometry.coordinates[0][0],\n        route.geometry.coordinates[0][1]\n      );\n\n      popup\n        .setLngLat(latLng)\n        .setHTML(ReactDOMServer.renderToString(<Popup route={route} />))\n        .addTo(map);\n    });\n  }\n\n  updateSelectedRoutePopup() {\n    if (this.props.selectedRoute.isSome()) {\n      this.showPopup(this.props.selectedRoute.value, this.popupSelectedRoute);\n    } else {\n      this.popupSelectedRoute.remove();\n    }\n  }\n\n  updateHoveredRoutePopup() {\n    const { hoveredRoute } = this.props;\n    if (\n      hoveredRoute.isSome() &&\n      hoveredRoute.value !== this.props.selectedRoute.fold(null, identity)\n    ) {\n      this.showPopup(hoveredRoute.value, this.popupHoveredRoute);\n    } else {\n      this.popupHoveredRoute.remove();\n    }\n  }\n\n  onFullscreenChange = () => {\n    if (document.fullscreenElement) {\n      this.map.map(map => map.scrollZoom.enable());\n      this.centerUserLocation();\n    } else {\n      this.map.map(map => map.scrollZoom.disable());\n    }\n  };\n\n  componentDidMount() {\n    this.initializeMap();\n    this.props.innerRef(this.map);\n\n    document.addEventListener(\"fullscreenchange\", this.onFullscreenChange);\n\n    this.positionWatch = some(\n      navigator.geolocation.watchPosition(position => {\n        localStorage.setItem(\"start_lat\", String(position.coords.latitude));\n        localStorage.setItem(\"start_lng\", String(position.coords.longitude));\n      })\n    );\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    this.updateLayers();\n    this.updateSelectedRoutePopup();\n    this.updateHoveredRoutePopup();\n\n    if (\n      this.props.selectedRoute.isSome() &&\n      (prevProps.selectedRoute.isNone() ||\n        prevProps.selectedRoute.value !== this.props.selectedRoute.value)\n    ) {\n      this.flyToRoute(this.props.selectedRoute.value);\n    }\n\n    if (this.props.navigating) {\n      this.centerUserLocation();\n    }\n\n    setTimeout(() => this.map.map(map => map.resize()), 30);\n  }\n\n  UNSAFE_componentWillMount() {\n    this.positionWatch.map(positionWatch =>\n      navigator.geolocation.clearWatch(positionWatch)\n    );\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"fullscreenchange\", this.onFullscreenChange);\n  }\n\n  render() {\n    return (\n      <View\n        grow\n        id=\"map\"\n        className={cx({ isNavigating: this.props.navigating })}\n      />\n    );\n  }\n}\n\nexport default App;\n","import * as React from \"react\";\nimport cx from \"classnames\";\nimport View from \"../View\";\nimport { Route as RouteT, viewToLocation } from \"../../model\";\nimport { Option, some } from \"fp-ts/lib/Option\";\nimport Button from \"@buildo/bento/components/Button\";\nimport { doUpdateLocation } from \"../../commands\";\nimport { declareCommands } from \"react-avenger\";\n\nimport \"./sideBar.scss\";\nimport \"@buildo/bento/components/button.scss\";\n\nconst Route = (props: {\n  route: RouteT;\n  onClick: () => void;\n  isSelected: boolean;\n  onDetailsClick: (e: React.SyntheticEvent<HTMLDivElement, Event>) => void;\n}) => (\n  <View\n    className={cx(\"route\", { \"is-selected\": props.isSelected })}\n    column\n    onClick={props.onClick}\n    shrink={false}\n  >\n    <View className=\"name\">{props.route.properties.name}</View>\n    <View className=\"distance\" vAlignContent=\"bottom\">\n      <label>Distance</label> {props.route.properties.length} km\n    </View>\n    <View className=\"min-elevation\" vAlignContent=\"bottom\">\n      <label>Elev (min)</label>{\" \"}\n      {Math.round(props.route.properties.minElevation)} m\n    </View>\n    <View className=\"max-elevation\" vAlignContent=\"bottom\">\n      <label>Elev (max)</label>{\" \"}\n      {Math.round(props.route.properties.maxElevation)} m\n    </View>\n\n    <View className=\"actions\">\n      <Button size=\"tiny\" label=\"Details\" onClick={props.onDetailsClick} />\n    </View>\n  </View>\n);\n\nconst commands = declareCommands({ doUpdateLocation });\n\ntype Props = typeof commands.Props & {\n  routes: RouteT[];\n  onRouteClick: (route: RouteT) => void;\n  selectedRoute: Option<RouteT>;\n};\n\nclass SideBar extends React.Component<Props> {\n  render() {\n    return (\n      <View className=\"side-bar\" column shrink={false}>\n        <h2>Routes</h2>\n        {this.props.routes.map((route, index) => (\n          <Route\n            key={index}\n            route={route}\n            onClick={() => this.props.onRouteClick(route)}\n            isSelected={\n              this.props.selectedRoute.isSome() &&\n              this.props.selectedRoute.value === route\n            }\n            onDetailsClick={(e) => {\n              e.stopPropagation();\n              this.props.doUpdateLocation(\n                viewToLocation({ view: \"details\", routeId: some(route.id) })\n              );\n            }}\n          />\n        ))}\n      </View>\n    );\n  }\n}\n\nexport default commands(SideBar);\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { routes } from \"../../queries\";\nimport View from \"../View\";\nimport Map, { getRouteDistanceInPixels } from \"../Map/Map\";\nimport SideBar from \"../SideBar/SideBar\";\nimport { Route } from \"../../model\";\nimport { Option, none, some } from \"fp-ts/lib/Option\";\nimport sortBy from \"lodash/sortBy\";\n\nimport \"./explorer.scss\";\n\nconst queries = declareQueries({ routes });\n\ntype Props = typeof queries.Props;\n\ntype State = {\n  selectedRoute: Option<Route>;\n  hoveredRoute: Option<Route>;\n};\n\nclass Explorer extends React.Component<Props, State> {\n  map: Option<mapboxgl.Map> = none;\n\n  state: State = {\n    selectedRoute: none,\n    hoveredRoute: none\n  };\n\n  onRouteSelect = (route: Route) => {\n    this.setState({\n      selectedRoute:\n        this.state.selectedRoute.isSome() &&\n        this.state.selectedRoute.value === route\n          ? none\n          : some(route)\n    });\n  };\n\n  onRouteHover = (route: Option<Route>) => {\n    this.setState({\n      hoveredRoute: route\n    });\n  };\n\n  render() {\n    return this.props.routes.fold(\n      null,\n      () => null,\n      routes => {\n        const sortedRoutes: Route[] = this.map.fold(routes, map =>\n          sortBy(routes, route =>\n            getRouteDistanceInPixels(route, map.getCenter(), map)\n          )\n        );\n\n        return (\n          <View className=\"explorer\" grow>\n            <SideBar\n              routes={sortedRoutes}\n              onRouteClick={this.onRouteSelect}\n              selectedRoute={this.state.selectedRoute}\n            />\n            <Map\n              routes={routes}\n              selectedRoute={this.state.selectedRoute}\n              hoveredRoute={this.state.hoveredRoute}\n              onRouteHover={this.onRouteHover}\n              onRouteSelect={this.onRouteSelect}\n              innerRef={map => {\n                this.map = map;\n                this.forceUpdate();\n              }}\n              startPosition=\"userLocation\"\n              navigating={false}\n            />\n          </View>\n        );\n      }\n    );\n  }\n}\n\nexport default queries(Explorer);\n","import * as React from \"react\";\nimport Modal from \"@buildo/bento/components/Modal\";\nimport View from \"../View\";\nimport Button from \"@buildo/bento/components/Button\";\n\nimport \"@buildo/bento/components/modal.scss\";\n\ntype Props = {};\n\ntype State = {\n  showModal: boolean;\n};\n\nlet fullscreen: boolean = false;\nlet documentHidden: { time: number; value: boolean } = {\n  time: 0,\n  value: false\n};\n\nexport default class FullscreenModal extends React.PureComponent<Props, State> {\n  state: State = {\n    showModal: false\n  };\n\n  onFullscreenChange = () => {\n    if (document.fullscreenElement) {\n      fullscreen = true;\n    } else {\n      setTimeout(() => {\n        fullscreen = false;\n      }, 30);\n    }\n  };\n\n  onVisibilityChange = () => {\n    if (\n      Date.now() > documentHidden.time + 300 &&\n      documentHidden.value &&\n      !document.hidden\n    ) {\n      if (fullscreen) {\n        this.setState({\n          showModal: true\n        });\n      }\n    }\n\n    documentHidden = {\n      time: Date.now(),\n      value: document.hidden\n    };\n  };\n\n  enterFullscreen = () => {\n    document.getElementById(\"map\")?.requestFullscreen();\n  };\n\n  componentDidMount() {\n    document.addEventListener(\"fullscreenchange\", this.onFullscreenChange);\n    document.addEventListener(\n      \"visibilitychange\",\n      this.onVisibilityChange,\n      false\n    );\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"fullscreenchange\", this.onFullscreenChange);\n    document.removeEventListener(\"visibilitychange\", this.onVisibilityChange);\n  }\n\n  onDismiss = () => {\n    fullscreen = false;\n    this.setState({\n      showModal: false\n    });\n  };\n\n  render() {\n    return this.state.showModal ? (\n      <Modal\n        className=\"fullscreenModal\"\n        transitionEnterTimeout={500}\n        transitionLeaveTimeout={500}\n        onDismiss={this.onDismiss}\n        iconClose={\n          <svg height=\"12\" viewBox=\"0 0 22 28\">\n            <path\n              fill=\"#9098a7\"\n              d=\"M20.281 20.656q0 0.625-0.438 1.062l-2.125 2.125q-0.438 0.438-1.062 0.438t-1.062-0.438l-4.594-4.594-4.594 4.594q-0.438 0.438-1.062 0.438t-1.062-0.438l-2.125-2.125q-0.438-0.438-0.438-1.062t0.438-1.062l4.594-4.594-4.594-4.594q-0.438-0.438-0.438-1.062t0.438-1.062l2.125-2.125q0.438-0.438 1.062-0.438t1.062 0.438l4.594 4.594 4.594-4.594q0.438-0.438 1.062-0.438t1.062 0.438l2.125 2.125q0.438 0.438 0.438 1.062t-0.438 1.062l-4.594 4.594 4.594 4.594q0.438 0.438 0.438 1.062z\"\n            ></path>\n          </svg>\n        }\n        title=\"Re-enter Fullscreen\"\n        footer={\n          <View style={{ justifyContent: \"space-between\" }}>\n            <Button size=\"medium\" onClick={this.onDismiss}>\n              No\n            </Button>\n            <Button primary size=\"medium\" onClick={this.enterFullscreen}>\n              Yes\n            </Button>\n          </View>\n        }\n      >\n        <span>Do do you want to re-enter fullscreen?</span>\n      </Modal>\n    ) : null;\n  }\n}\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { route, routeReadme } from \"../../queries\";\nimport View from \"../View\";\nimport Map from \"../Map/Map\";\nimport * as RemarkableModule from \"remarkable\";\nimport { none } from \"fp-ts/lib/Option\";\nimport { Route } from \"../../model\";\nimport Button from \"@buildo/bento/components/Button\";\nimport { saveAs } from \"file-saver\";\nimport { Carousel } from \"react-responsive-carousel\";\nimport { Line, defaults } from \"react-chartjs-2\";\nimport * as geoJsonLength from \"geojson-length\";\nimport uniq from \"lodash/uniq\";\nimport FullscreenModal from \"../FullscreenModal/FullscreenModal\";\nimport NoSleep from \"nosleep.js\";\n\nimport \"react-responsive-carousel/lib/styles/carousel.min.css\";\nimport \"./details.scss\";\n\nconst noSleep = new NoSleep();\nconst { linkify } = require(\"remarkable/linkify\");\n\ndefaults.global.animation = 0;\n\nconst togpx = require(\"togpx\");\n\nconst Remarkable = (RemarkableModule as any).Remarkable as RemarkableModule;\n\nconst saveGPX = (route: Route): void => {\n  const blob = new Blob([togpx(route)], {\n    type: \"text/plain;charset=utf-8\"\n  });\n\n  saveAs(blob, `${route.properties.name}.gpx`);\n};\n\nclass Markdown extends React.PureComponent<{\n  routeReadme: string;\n  route: Route;\n  navigating: boolean;\n  onEnterNavigation: () => void;\n  onExitNavigation: () => void;\n}> {\n  componentDidMount() {\n    this.forceUpdate();\n  }\n\n  render() {\n    const images = Array.from(\n      document.querySelectorAll<HTMLImageElement>(\".remarkable img\")\n    );\n\n    const h1 = document.querySelector<HTMLElement>(\n      \".remarkable h1:first-of-type\"\n    );\n\n    return (\n      <View className=\"markdown\" hAlignContent=\"center\" shrink={false}>\n        {this.props.navigating && (\n          <View\n            className=\"exit-navigation\"\n            onClick={this.props.onExitNavigation}\n            hAlignContent=\"center\"\n            vAlignContent=\"center\"\n          >\n            <svg width=\"29\" height=\"29\" viewBox=\"0 0 29 29\">\n              <path\n                fill=\"black\"\n                d=\"M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z\"\n              ></path>\n            </svg>\n          </View>\n        )}\n\n        <View className=\"wrapper\" grow>\n          <View grow column style={{ position: \"relative\" }}>\n            <View className=\"title\">{h1?.innerText}</View>\n            <View className=\"actions\">\n              <Button\n                flat\n                size=\"medium\"\n                label=\"Enter Navigation\"\n                onClick={this.props.onEnterNavigation}\n              />\n              <Button\n                flat\n                size=\"medium\"\n                label=\"Download GPX\"\n                onClick={() => saveGPX(this.props.route)}\n              />\n            </View>\n\n            <div\n              className=\"remarkable\"\n              dangerouslySetInnerHTML={{\n                __html: md.render(this.props.routeReadme)\n              }}\n            />\n\n            <View className=\"summary\">\n              <View className=\"distance\" column shrink={false}>\n                <span>{this.props.route.properties.length} km</span>\n                <label>Distance</label>\n              </View>\n              <View className=\"min-elevation\" column shrink={false}>\n                <span>\n                  {Math.round(this.props.route.properties.minElevation)} m\n                </span>\n                <label>Min elevation</label>\n              </View>\n              <View className=\"max-elevation\" column shrink={false}>\n                <span>\n                  {Math.round(this.props.route.properties.maxElevation)} m\n                </span>\n                <label>Max elevation</label>\n              </View>\n            </View>\n          </View>\n          <View className=\"images\" hAlignContent=\"right\" shrink={false}>\n            <Carousel\n              showThumbs={false}\n              showStatus={false}\n              showIndicators={images.length > 1}\n              infiniteLoop\n              autoPlay\n              interval={6000}\n            >\n              {images.map(image => (\n                <img key={image.src} src={image.src} alt={image.src} />\n              ))}\n            </Carousel>\n          </View>\n          <View className=\"mobile-images\" grow>\n            {images.slice(0, 2).map(image => (\n              <img key={image.src} src={image.src} alt={image.src} />\n            ))}\n          </View>\n        </View>\n      </View>\n    );\n  }\n}\n\nconst md = new (Remarkable as any)().use(linkify);\n\nconst queries = declareQueries({ route, routeReadme });\n\ntype Props = typeof queries.Props;\n\ntype State = {\n  navigating: boolean;\n};\n\nclass Details extends React.Component<Props, State> {\n  state: State = {\n    navigating: false\n  };\n\n  render() {\n    return this.props.route.fold(\n      null,\n      () => null,\n      route =>\n        this.props.routeReadme.fold(\n          null,\n          () => null,\n          routeReadme => {\n            if (route.isNone() || routeReadme.isNone()) {\n              return null;\n            } else {\n              const scale = Math.round(route.value.properties.length / 10) || 1;\n\n              const round = (\n                number: number,\n                roundedInteger: number\n              ): number => {\n                const remainder = number % roundedInteger;\n                const discriminatingFactor = roundedInteger / 2;\n\n                const flooredNumber = Math.round(number - remainder);\n\n                if (remainder < discriminatingFactor) {\n                  return flooredNumber;\n                } else {\n                  return flooredNumber + roundedInteger;\n                }\n              };\n\n              const distances = route.value.geometry.coordinates.map(\n                (_, i) =>\n                  geoJsonLength({\n                    ...route.value.geometry,\n                    coordinates: route.value.geometry.coordinates.slice(\n                      0,\n                      i + 1\n                    )\n                  }) / 1000\n              );\n\n              const ticks = uniq(distances.map(d => round(d, scale)));\n\n              const elevations = route.value.geometry.coordinates.map(c =>\n                c[2] ? Math.round(c[2]) : null\n              );\n\n              return (\n                <View className=\"details\" height=\"100%\" grow column>\n                  <FullscreenModal />\n\n                  <Markdown\n                    routeReadme={routeReadme.value}\n                    route={route.value}\n                    onEnterNavigation={() => {\n                      noSleep.enable();\n                      this.setState({ navigating: true });\n                    }}\n                    onExitNavigation={() => {\n                      noSleep.disable();\n                      this.setState({ navigating: false });\n                    }}\n                    navigating={this.state.navigating}\n                  />\n\n                  <View shrink={false} className=\"map-wrapper\">\n                    <Map\n                      routes={[route.value]}\n                      startPosition=\"firstRoute\"\n                      navigating={this.state.navigating}\n                      hoveredRoute={route} // fixed blue color that is easily visible\n                      // fake props\n                      selectedRoute={none}\n                      onRouteHover={() => {}}\n                      onRouteSelect={() => {}}\n                      innerRef={() => {}}\n                    />\n                  </View>\n                  <View className=\"elevation-profile-wrapper\" shrink={false}>\n                    <Line\n                      data={{\n                        datasets: [\n                          {\n                            label: \"Elevation\",\n                            pointRadius: 0,\n                            borderWidth: 0,\n                            yAxisID: \"y-axis\",\n                            xAxisID: \"x-axis-hidden\",\n                            data: elevations\n                          },\n                          {\n                            xAxisID: \"x-axis\",\n                            data: []\n                          }\n                        ]\n                      }}\n                      options={{\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        scales: {\n                          xAxes: [\n                            {\n                              id: \"x-axis-hidden\",\n                              type: \"category\",\n                              labels: distances.map(d => d.toFixed(1)),\n                              display: false\n                            },\n                            {\n                              id: \"x-axis\",\n                              labels: ticks,\n                              ticks: {\n                                callback: (value: number) => {\n                                  return value < route.value.properties.length\n                                    ? `${value} km`\n                                    : null;\n                                }\n                              }\n                            }\n                          ],\n                          yAxes: [\n                            {\n                              type: \"linear\",\n                              id: \"y-axis\",\n                              ticks: {\n                                precision: 0,\n                                maxRotation: 0,\n                                stepSize: 50,\n                                suggestedMin:\n                                  route.value.properties.minElevation * 0.7,\n                                suggestedMax: 300,\n                                ticks: {\n                                  callback: (value: number) => {\n                                    return `${value} m`;\n                                  }\n                                }\n                              }\n                            }\n                          ]\n                        },\n                        tooltips: {\n                          mode: \"index\",\n                          intersect: false,\n                          callbacks: {\n                            title: (tooltipItems: any[]) => {\n                              return `Dist:  ${tooltipItems[0].label} km`;\n                            },\n                            label: () => \"\",\n                            footer: (tooltipItems: any[], data: unknown) => {\n                              return `Elev: ${tooltipItems[0].value} m`;\n                            }\n                          }\n                        }\n                      }}\n                      legend={null}\n                      height={50}\n                    />\n                  </View>\n                </View>\n              );\n            }\n          }\n        )\n    );\n  }\n}\n\nexport default queries(Details);\n","import App from './App';\nexport default App;\n","import * as React from \"react\";\nimport { declareQueries } from \"@buildo/bento/data\";\nimport { currentView } from \"../../queries\";\nimport View from \"../View\";\nimport Explorer from \"../Explorer/Explorer\";\nimport Details from \"../Details/Details\";\n\nconst queries = declareQueries({ currentView });\n\ntype Props = typeof queries.Props;\n\nclass App extends React.Component<Props> {\n  render() {\n    return this.props.currentView.fold(\n      null,\n      () => null,\n      (currentView) => (\n        <View className=\"app\" height=\"100%\">\n          {currentView.view === \"explorer\" && <Explorer />}\n          {currentView.view === \"details\" && <Details />}\n        </View>\n      )\n    );\n  }\n}\n\nexport default queries(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","// This script adds \"is-desktop\", \"is-phone\" or \"is-tablet\" class to the root document element\n\nimport cx from \"classnames\";\nimport mobileDetect from \"@buildo/bento/utils/mobileDetect\";\n\nconst md = mobileDetect();\n\nconst deviceClassName = cx({\n  \"is-desktop\": md.isDesktop,\n  \"is-tablet\": md.isTablet,\n  \"is-phone\": md.isPhone,\n});\n\n// document.documentElement is not supported in every browser, fallback on document.body\nconst body = document.documentElement || document.body;\n\nbody.className = cx(body.className, deviceClassName);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nimport \"./setup/addDeviceClassName\";\nimport \"./theme\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"app\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}